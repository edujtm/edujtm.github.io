{"componentChunkName":"component---src-templates-blog-js","path":"/pt/blog/opencv-tilt-shift","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Simulando o efeito tilt-shift com OpenCV","date":"06/12/2020"},"html":"<p>Fotografos profissionais estão sempre buscando por efeitos que destacam as partes interessantes de um cenário, para atingir este objetivo eles utilizam-se de sua maestria da iluminação de cenários junto com algumas lentes avançadas para cameras que os permitem obter o efeito desejado como, por exemplo, o destaque de uma pessoa em primeiro plano, enquanto mantem-se o fundo ao redor dela borrado.</p>\n<p>Já que estas cameras necessitam de um processo de engenharia bastante complicado para ser feitas, seus preços são normalmente bastante caros, o que pode manter alguns aspirantes a fotográfos longe da prática. Felizmente, nós podemos simular alguns desses efeitos em um computador utilizando técnicas de processamento de images, o que nos permitem testar diversos efeitos sem precisar comprar uma dessas câmeras.</p>\n<p>Um efeito interessante que nós podemos testar é chamado de tilt-shift, que é criado como resultado da inclinação das lentes em relação ao sensor da câmera de forma que apenas uma subseção do cenário ficará em foco. Esse efeito é famoso por fazer com que a figura apareça como uma fotografia de um mundo em miniaturas. Alguns desses efeitos podem ser vistos nas imagens abaixo:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQP/2gAMAwEAAhADEAAAAUetclzDeG//xAAaEAACAwEBAAAAAAAAAAAAAAABAgMEERIj/9oACAEBAAEFAo4zwUbHrybVfyIRQzaf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABURAQEAAAAAAAAAAAAAAAAAAAAS/9oACAECAQE/AVv/xAAaEAACAgMAAAAAAAAAAAAAAAAAAREyEiEx/9oACAEBAAY/Ap02J2kqiqG8Th//xAAbEAACAwEBAQAAAAAAAAAAAAABEQAhMUFhof/aAAgBAQABPyEog8TyIBYIQp/pHVBars7DnHAcirZ//9oADAMBAAIAAwAAABA3D//EABcRAAMBAAAAAAAAAAAAAAAAAAARMVH/2gAIAQMBAT8QeQQ//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERITH/2gAIAQIBAT8Q64zOQ//EABwQAQEAAgMBAQAAAAAAAAAAAAERACExUWFBsf/aAAgBAQABPxBYDAXPmk1mxY4KohfzNxdLxMHjFrs7fcGBUlqF4p1iNfIfzP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Trabalhadores de uma construção com tilt-shift aplicado, devido ao efeito os trabalhadores parecem miniaturas\"\n        title=\"Trabalhadores de uma construção com tilt-shift aplicado, devido ao efeito os trabalhadores parecem miniaturas\"\n        src=\"/static/faa02817e41d9393fd7cf20e67265396/acb04/tilt-shift-1.jpg\"\n        srcset=\"/static/faa02817e41d9393fd7cf20e67265396/bc01b/tilt-shift-1.jpg 188w,\n/static/faa02817e41d9393fd7cf20e67265396/bf173/tilt-shift-1.jpg 375w,\n/static/faa02817e41d9393fd7cf20e67265396/acb04/tilt-shift-1.jpg 750w,\n/static/faa02817e41d9393fd7cf20e67265396/ec605/tilt-shift-1.jpg 1125w,\n/static/faa02817e41d9393fd7cf20e67265396/c58a3/tilt-shift-1.jpg 1500w,\n/static/faa02817e41d9393fd7cf20e67265396/c83bb/tilt-shift-1.jpg 4608w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABXVAvLSJCP//EABgQAQEBAQEAAAAAAAAAAAAAAAECAAMh/9oACAEBAAEFAi/B00VMhutM0Lv/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAECEiH/2gAIAQIBAT8BqKCen//EAB4QAAIBAwUAAAAAAAAAAAAAAAERAAIQIRIxQVGh/9oACAEBAAY/Am8Tfhx6vYB3VCAcO3//xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhQWH/2gAIAQEAAT8hLvNQu6SPT5iEMUMci5qxwmFQd//aAAwDAQACAAMAAAAQly//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EHBaw//EABgRAAMBAQAAAAAAAAAAAAAAAAABESEx/9oACAECAQE/EL6IVT0//8QAHBABAAICAwEAAAAAAAAAAAAAAQARIUExUXHh/9oACAEBAAE/EDPWARX7HGnAgaJ3ec6iSvTRlqjkDaUYvncuTPQ66lwIDgPCf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Uma imagem de casas em uma vizinhança com efeito tilt-shift\"\n        title=\"Uma imagem de casas em uma vizinhança com efeito tilt-shift\"\n        src=\"/static/23bfa798d567f0778db4079478e8a31e/acb04/tilt-shift-2.jpg\"\n        srcset=\"/static/23bfa798d567f0778db4079478e8a31e/bc01b/tilt-shift-2.jpg 188w,\n/static/23bfa798d567f0778db4079478e8a31e/bf173/tilt-shift-2.jpg 375w,\n/static/23bfa798d567f0778db4079478e8a31e/acb04/tilt-shift-2.jpg 750w,\n/static/23bfa798d567f0778db4079478e8a31e/ec605/tilt-shift-2.jpg 1125w,\n/static/23bfa798d567f0778db4079478e8a31e/c58a3/tilt-shift-2.jpg 1500w,\n/static/23bfa798d567f0778db4079478e8a31e/93719/tilt-shift-2.jpg 4000w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>O objetivo desse artigo é tentar simular o este efeito no pós-processamento com OpenCV. Essa simulação talvez não dê todas as funcionalidades que você teria com lentes de câmeras profissionais, mas ainda assim é uma forma interessante de observar o que o processamento de imagens é capaz de fazer.</p>\n<h2 id=\"entendendo-como-simular-o-efeito\" style=\"position:relative;\"><a href=\"#entendendo-como-simular-o-efeito\" aria-label=\"entendendo como simular o efeito permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entendendo como simular o efeito</h2>\n<p>Para obter o efeito tilt-shift nós precisamos notar que a imagem original é borrada em algumas seções e mantida sem processamento em outras. Se você leu o artigo sobre <a href=\"/blog/opencv-spatial-filters\">filtros espaciais</a> anteriormente, você sabe que podemos borrar uma imagem ao aplicar um filtro suavizante, o que nós dá parte do efeito que queremos.</p>\n<p>Após aplicar o filtro, nós temos uma imagem borrada junto com a imagem original não processada. Nós precisamos encontrar uma forma de misturas estas imagens de forma que o efeito seja similar ao do tilt-shift. A mistura de imagens no OpenCV é feita por meio da função <a href=\"https://docs.opencv.org/4.4.0/d2/de8/group__core__array.html#gafafb2513349db3bcff51f54ee5592a19\">cv::addWeighted()</a>, que faz uma adição elemento a elemento entre duas imagens, utilizando um peso especificado para cada. A operação matemática que ela implementa é dada abaixo:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>α</mi><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>1</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>β</mi><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\tdst(I) = \\alpha \\cdot src_{1}(I) + \\beta \\cdot  src_{2}(I) + \\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span></span>\n<p>Onde <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">dst</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span></span></span></span> representa a imagem de destino, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">src_{1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">src_{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> são as imagens de entrada e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span> são os coeficientes definidos pelo usuário. Para fazer a mistura das imagens, nós precisamos modifcá-la um pouco para que os coeficientes representem o quão forte será o efeito de cada imagem na saida da operação. Então nós obtemos a seguinte definição:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>α</mi><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>1</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\tdst(I) = \\alpha \\cdot src_{1}(I) + (1 - \\alpha) \\cdot src_{2}(I)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span></span></span></span></span>\n<p>Com esta função nos podemos misturar a imagem original com a borrada, mas isto ainda não é o efeito que queremos, já que irá combinar ambas as imagens completamente e nós queremos que apenas certas partes sejam combinadas. Para corrigir isso, nós precisamos variar os coeficientes de forma que em algumas seções a imagem borrada tenha mais efeito e em outras, a imagem original tenha efeito maior. Isto é feito utilizando a seguinte função para caracterizar os coeficientes:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>α</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>l</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>l</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>tanh</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>l</mi><mn>1</mn></mrow><mi>d</mi></mfrac><mo stretchy=\"false\">)</mo><mo>−</mo><mi>tanh</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>l</mi><mn>2</mn></mrow><mi>d</mi></mfrac><mo stretchy=\"false\">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">\t\\alpha(x, l1, l2, d) = \\frac{\\tanh(\\frac{x - l1}{d}) - \\tanh(\\frac{x - l2}{d})}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3011079999999997em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6151079999999998em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.7350000000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\">tanh</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801079999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mop\">tanh</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801079999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>Onde <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span></span></span></span> e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">l2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span></span></span></span> são os pontos de transição na imagem, onde ela muda entre borrada e não-borrada, e o parâmetro <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> representa o quão rápido esta transição acontece. Isto pode ser difícil de entender a partir da definição matemática por si só, então vamos olhar o gráfico da função para os parâmetros <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span></span></span></span> = -20, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">l2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span></span></span></span> = 30 e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> = 6.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAjEAAAIxAHydkeTAAAA10lEQVQoz5VS2xKEIAj1/7+2DPCCM6xQNtpauz2c4s5BcDlnYeYvZN7t6iciiSlKyslwm1PtTj8zcGahSIIBxYMXJDx1IJC7PPfUDWpyKUUCBdMLF9OVrRbvJ3lkqE4KJCGGXa4jp5SGGG02Zdi62v+Q1YERrZgxDAfDKnPhgeWQW+H0fTbcTqi++EUAwZgpAMCKNr3Bb17WbR1yXYzRuvXQ8RqMLaJoXG9vviG3xrjZQq5ob/hP7LnlfiFX/VrwGte2PZzN24Kv77BH2/KvuCnD6U2+YPgB3zysqmbYojIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Gráfico da função que define os coeficientes\"\n        title=\"Gráfico da função que define os coeficientes\"\n        src=\"/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/1d69c/geogebra-tanh.png\"\n        srcset=\"/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/4dcb9/geogebra-tanh.png 188w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/5ff7e/geogebra-tanh.png 375w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/1d69c/geogebra-tanh.png 750w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/78797/geogebra-tanh.png 1125w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/aa440/geogebra-tanh.png 1500w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/1307b/geogebra-tanh.png 3000w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Nós podemos interpretar este gráfico ao pensar que nos pontos onde o valor é 0, a imagem resultante será borrada e onde é igual a 1, a imagem de saída não terá nenhum efeito aplicado. Dessa forma, apenas as regiões próximas do topo e parte inferior da imagem serão borradas, o que nos dá um efeito similar ao tilt-shift. Nós também podemos notar que os pontos de inflexão das curvas são dados pelos parâmetros <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span></span></span></span> e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">l2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span></span></span></span>, nós podemos utilizar isto para manipular qual seção da imagem será borrada.</p>\n<p>Agoras nós temos uma forma de simular o tilt-shift: nós borramos a imagem original e combinamos esta imagem borrada com a original utilizando um adição com pesos, onde estes pesos são dados pela função que nós definimos acima. Vamos ver como fazer como fazer isto no OpenCV.</p>\n<h2 id=\"colocando-em-prática\" style=\"position:relative;\"><a href=\"#colocando-em-pr%C3%A1tica\" aria-label=\"colocando em prática permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Colocando em prática</h2>\n<p>A primeira coisa que precisamos fazer é traduzir a função de caracterização dos coeficientes em uma máscasra que podemos aplicar na imagem. A máscara que queremos criar deve ser similar a essa:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYCBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGzDCbxdGAP/8QAGhAAAQUBAAAAAAAAAAAAAAAABAACAxATAf/aAAgBAQABBQLAdFySsfuRXa//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIQQQMRMf/aAAgBAQAGPwKhqY+aLhI//8QAGxAAAQQDAAAAAAAAAAAAAAAAAQAQEfAxYXH/2gAIAQEAAT8huKmR0hXBsOG//9oADAMBAAIAAwAAABAjz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB4QAAIABgMAAAAAAAAAAAAAAAABESFhcbHwEEGh/9oACAEBAAE/EK+txJjPE5k4tYKetjo8fHH/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Mask created using the characterization function\"\n        title=\"Mask created using the characterization function\"\n        src=\"/static/ddaada636d412cf79a3834fe066f2745/b4294/example-mask.jpg\"\n        srcset=\"/static/ddaada636d412cf79a3834fe066f2745/bc01b/example-mask.jpg 188w,\n/static/ddaada636d412cf79a3834fe066f2745/bf173/example-mask.jpg 375w,\n/static/ddaada636d412cf79a3834fe066f2745/b4294/example-mask.jpg 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>As partes escuras da máscara esquerda são as seções da imagem original em que ela terá menor efeito no resultado (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> = 0), a parte clara é onde a imagem original terá maior efeito (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> = 1). Nós precisamos de duas máscaras porquê uma será aplicada na imagem original e outra na imagem borrada.</p>\n<p>Para criar esta máscara, nós iremos primeiro criar um array de tamanho igual à altura da imagem, preenchido com amostras discretas da função. Isto é feito por meio da seguinta função no C++:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdio></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cmath></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;opencv2/opencv.hpp></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;lyra/lyra.hpp></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\"><span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>exp<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">,</span> exp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token comment\">// ------ Geração da máscara de blending -------</span>\n\n<span class=\"token comment\">// Gera dados para uma única linha da máscara de blending dada a função:</span>\n<span class=\"token comment\">//</span>\n<span class=\"token comment\">// ( tanh((x - lb) / decay) - tanh((x - hb) / decay) ) / 2</span>\n<span class=\"token comment\">//</span>\n<span class=\"token comment\">// Esta função será avaliada entre [low_bound] e [high_bound]</span>\n<span class=\"token comment\">// e irá gerar um vetor com exatamente [size] valores.</span>\nstd<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> <span class=\"token function\">blend</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> min_range<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> max_range<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> low_bound<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> high_bound<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> decay<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>min_range <span class=\"token operator\">&lt;</span> max_range<span class=\"token punctuation\">,</span> <span class=\"token string\">\"blend range is defined incorrectly. min_range >= max_range\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>low_bound <span class=\"token operator\">&lt;=</span> high_bound<span class=\"token punctuation\">,</span> <span class=\"token string\">\"boundary range is defined incorrectly. low_bound > high_bound\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>decay <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"decay coefficient is equal to zero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> lu_table<span class=\"token punctuation\">;</span>\n    lu_table<span class=\"token punctuation\">.</span><span class=\"token function\">reserve</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// Preallocate memory since we already know the final size</span>\n\n    <span class=\"token keyword\">float</span> step <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>max_range <span class=\"token operator\">-</span> min_range<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> size<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> size<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">float</span> x <span class=\"token operator\">=</span> min_range <span class=\"token operator\">+</span> i <span class=\"token operator\">*</span> step<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">float</span> result <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span><span class=\"token function\">tanh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-</span> low_bound<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> decay<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> std<span class=\"token operator\">::</span><span class=\"token function\">tanh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-</span> high_bound<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> decay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        lu_table<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> lu_table<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Está função avalia a função de caracterização de coeficientes para valores entre [<em>min_range</em>, <em>max_range</em>], amostrando-a em intervalos iguais com periodo definido pela variável <em>step</em>. Os valroes resultantes são armazenados em um array e returnados para o invocador da função. A função assertm é usada para fazer algumas asserções simples sobre suas invariantes.</p>\n<p>Após executar esta função, nós obtemos um array com os valores desejados, mas isso ainda não é a máscara que queremos. Para completar o processo, precisamos transpor o array e copiá-lo pelas colunas até que tenhamos a mesma largura da imagem. Para fazer isso, precisamos definir outra função:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">cv<span class=\"token operator\">::</span>Mat <span class=\"token function\">smooth_blend_mask</span><span class=\"token punctuation\">(</span>\n    cv<span class=\"token operator\">::</span>Size size<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">int</span> min_range<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">int</span> max_range<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">int</span> low_bound<span class=\"token punctuation\">,</span> \n    <span class=\"token keyword\">int</span> high_bound<span class=\"token punctuation\">,</span> \n    <span class=\"token keyword\">int</span> decay\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cv<span class=\"token operator\">::</span>Mat <span class=\"token function\">mask</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> blend_values <span class=\"token operator\">=</span> <span class=\"token function\">blend</span><span class=\"token punctuation\">(</span>min_range<span class=\"token punctuation\">,</span> max_range<span class=\"token punctuation\">,</span> low_bound<span class=\"token punctuation\">,</span> high_bound<span class=\"token punctuation\">,</span> decay<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span>Mat <span class=\"token function\">blend_mask_row</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">,</span> blend_values<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Repete a linha com valores de blending para gerar uma máscara</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> size<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        blend_mask_row<span class=\"token punctuation\">.</span><span class=\"token function\">copyTo</span><span class=\"token punctuation\">(</span>mask<span class=\"token punctuation\">.</span><span class=\"token function\">row</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Os valores da função foram dispostos horizontalmente</span>\n    <span class=\"token comment\">// mas nós queremos que a máscara seja vertical ao invés de horizontal</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">transpose</span><span class=\"token punctuation\">(</span>mask<span class=\"token punctuation\">,</span> mask<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> mask<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Nesse trecho de código, eu copiei o array de dados horizontalmente e tranpus a máscara resultante, o que nós dá o mesmo resultado de transpor o array primeiro e depois copiá-lo pela coluna.</p>\n<p>Com a máscara pronta, é possível aplicá-la na imagem e ver o efeito de tilt-shift resultante, mas antes de fazer isto, vamos utilizando as ferramentas de interface de usuário do OpenCV para que possamos manipular o efeito e entender melhor como ele funciona.</p>\n<p>Nós iremos definir 3 sliders:</p>\n<ul>\n<li><strong>center</strong> - O ponto médio onde a máscara será aplicada na imagem.</li>\n<li><strong>decay</strong> - O quão rápido a transição entre borrado e não-borrado acontece.</li>\n<li><strong>range</strong> - O quão larga será a seção não-borrada da imagem.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// ------  Gerenciamento de sliders da UI -------</span>\n\n<span class=\"token comment\">//  Ponto médio da máscara</span>\n<span class=\"token keyword\">int</span> center <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> center_slider <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> center_slider_max <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// O quão rápido a transição entre borrado e não borrado</span>\n<span class=\"token comment\">// acontece</span>\n<span class=\"token keyword\">int</span> decay <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> decay_slider <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> decay_slider_max <span class=\"token operator\">=</span> <span class=\"token number\">39</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Define a seção não borrada da imagem</span>\n<span class=\"token keyword\">int</span> range <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> range_slider <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> range_slider_max <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\ncv<span class=\"token operator\">::</span>Mat image<span class=\"token punctuation\">,</span> blur_mask<span class=\"token punctuation\">,</span> blurred_image<span class=\"token punctuation\">;</span>\ncv<span class=\"token operator\">::</span>Mat weighted_blur<span class=\"token punctuation\">,</span> weighted_image<span class=\"token punctuation\">,</span> blended<span class=\"token punctuation\">;</span>\ncv<span class=\"token operator\">::</span>Mat imageTop<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">char</span> trackbar_name<span class=\"token punctuation\">[</span><span class=\"token number\">50</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">auto</span> min_range <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token operator\">-</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> max_range <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token operator\">-</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> low_bound <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>range <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> hi_bound <span class=\"token operator\">=</span> <span class=\"token operator\">+</span>range <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    blur_mask <span class=\"token operator\">=</span> <span class=\"token function\">smooth_blend_mask</span><span class=\"token punctuation\">(</span>\n        image<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n        min_range<span class=\"token punctuation\">,</span>\n        max_range<span class=\"token punctuation\">,</span>\n        low_bound<span class=\"token punctuation\">,</span> \n        hi_bound<span class=\"token punctuation\">,</span> \n        decay\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat bgr_mask<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// transforma a máscara de um canal em uma imagem de três canais</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">cvtColor</span><span class=\"token punctuation\">(</span>blur_mask<span class=\"token punctuation\">,</span> bgr_mask<span class=\"token punctuation\">,</span> cv<span class=\"token operator\">::</span>COLOR_GRAY2BGR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> inverse_mask <span class=\"token operator\">=</span> <span class=\"token function\">CV_RGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> bgr_mask<span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span><span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>bgr_mask<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">,</span> weighted_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>inverse_mask<span class=\"token punctuation\">,</span> blurred_image<span class=\"token punctuation\">,</span> weighted_blur<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>weighted_image<span class=\"token punctuation\">,</span> weighted_blur<span class=\"token punctuation\">,</span> blended<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    blended<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>blended<span class=\"token punctuation\">,</span> CV_8UC3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">imshow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span> blended<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">on_trackbar_center_changed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    center <span class=\"token operator\">=</span> center_slider<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">on_trackbar_decay_changed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    decay <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> decay_slider<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">on_trackbar_range_changed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    range <span class=\"token operator\">=</span> range_slider<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>A parte mais interessante do trecho acima é a função <em>do_blending()</em>, que inicia com a definição dos intervalos em que o função dos coeficientes será avaliada e a variável de centro, que não representa o centro da máscara, nem o centro da imagem, mas na verdade um mapeamento entre a imagem e a máscara: Quando <em>center = 0</em> o centro da função estará no início da imagem, quando <em>centro = 50</em> o centro da função está no meio da imagem e quando <em>center = 100</em>, o centro da função estará no final da imagem.</p>\n<p>Isto é mais simples de ser observado a partir de imagens:</p>\n<p>Quando <em>center = 0</em> :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3klEQVQoz4VSi3KEMAjM//9r61UbHoFkC6l63o3TMrOT5eFCMAW7jTHOs1mHeZ++u4OIJu99QM1fat+t3Ak+vgWfm8BDQNRQiREUVQwfqwT/Q/AafOExmbcGienqtqEHT9zWBj/8cjjXYDebmDyEReTk2WRcRN5RcGOu+hTPvYV/mKX4zVXPKy/LghZdDygzqFZwfGgxZU5HVCdv1lAjl2s46s1t/rTUyZoyCzNxOSlEZRfMGJNAWKCiWNctcvoEy4msLfjHejwfehC06r4OB38xmvzuuHE0jBeRsVzuD+PTd3ioZqEoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Função de coeficiente quando o center é igual a 0\"\n        title=\"Função de coeficiente quando o center é igual a 0\"\n        src=\"/static/ed0db375b09dcb2d7981c89bb05ad4d9/f2793/function-center-0.png\"\n        srcset=\"/static/ed0db375b09dcb2d7981c89bb05ad4d9/4dcb9/function-center-0.png 188w,\n/static/ed0db375b09dcb2d7981c89bb05ad4d9/5ff7e/function-center-0.png 375w,\n/static/ed0db375b09dcb2d7981c89bb05ad4d9/f2793/function-center-0.png 743w\"\n        sizes=\"(max-width: 743px) 100vw, 743px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Quando <em>center = 50</em> :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQoz31SgRKDIAj1//91q1UqiPoGXLXavHH3zgfRA8SA3Xrv51mkQWpzv9aKlJLz1jpY6i3328JIcN4Iz5VQVYBYEFOGUkQSPBZS/kfwGrxx7ayWAtLu4rqiKTcMc5Uffjica7CJOJyrMBGd3Ir0i8g3AgZWmT/irYHVP0xMfDDqOfI0TSha9QDn7EuwrkS7ZCbEGJ0XKc7tGooWsXyLW8x0jAdP3D+4KBesy6ZJCUx8gvbzNS8qSJ7386/iNrI/mVyQ5qT31dzPulXetJss7pNu38CRhyO/Ac07d2nf/UjrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Função de coeficiente quando o center é igual a 50\"\n        title=\"Função de coeficiente quando o center é igual a 50\"\n        src=\"/static/49b1700e954b4affda704d89b6d827e0/f2793/function-center-50.png\"\n        srcset=\"/static/49b1700e954b4affda704d89b6d827e0/4dcb9/function-center-50.png 188w,\n/static/49b1700e954b4affda704d89b6d827e0/5ff7e/function-center-50.png 375w,\n/static/49b1700e954b4affda704d89b6d827e0/f2793/function-center-50.png 743w\"\n        sizes=\"(max-width: 743px) 100vw, 743px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Quando <em>center = 100</em> :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4ElEQVQoz31Ri3IDIQj0//+1vWtOBXxtF1PTS+YSZhh2URaUgD8bYzxiqR219clba8g5T9z7gNX2dPfVwpXgHhXfh6JRQK0iZQEhklZ83ZT4g+A5+YQ5WSsFyunScaATu1/eJV48LHJO9lqnT0xhVX1gbzJOIq8ecGHN7F+8dxj5smrqanhnYd93LqGglLubCHJKc6rKKV0skTv28xQjlLww79zzfr5t28RBxaCiFLDpxbwoUTTDPJd1xlUcKbiaryYruoe8szDdn1SkQG4Ci8b/GqjcqnDb8iMY/f0zz/YLvIB3bQVnQdcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Função de coeficiente quando o center é igual a 50\"\n        title=\"Função de coeficiente quando o center é igual a 50\"\n        src=\"/static/aca6b66ba64fcb463af9aa55d4e5bd65/f2793/function-center-100.png\"\n        srcset=\"/static/aca6b66ba64fcb463af9aa55d4e5bd65/4dcb9/function-center-100.png 188w,\n/static/aca6b66ba64fcb463af9aa55d4e5bd65/5ff7e/function-center-100.png 375w,\n/static/aca6b66ba64fcb463af9aa55d4e5bd65/f2793/function-center-100.png 743w\"\n        sizes=\"(max-width: 743px) 100vw, 743px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Você pode pensar sobre o eixo vertical da imagem como sendo a linha roxa nas figuras acima.</p>\n<p>Por fim, nós podemos unir tudo e observar os resultados.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdio></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cmath></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;opencv2/opencv.hpp></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;lyra/lyra.hpp></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\"><span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>exp<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">,</span> exp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>string image_path<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> height<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nConfig <span class=\"token function\">parse_cli</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n   <span class=\"token comment\">/* Obter argumentos da linha de comando */</span> \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Definição da função de blending */</span>\n\n<span class=\"token comment\">/* Definição da função da máscara de blending */</span>\n\n<span class=\"token comment\">/* sliders e listeners da UI */</span>\n\n<span class=\"token keyword\">const</span> cv<span class=\"token operator\">::</span>Matx33f filtro_borramento <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">auto</span> config <span class=\"token operator\">=</span> <span class=\"token function\">parse_cli</span><span class=\"token punctuation\">(</span>argc<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    image <span class=\"token operator\">=</span> cv<span class=\"token operator\">::</span><span class=\"token function\">imread</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Size image_size <span class=\"token punctuation\">{</span> config<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>height <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">resize</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">,</span> image_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> CV_32FC3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">copyTo</span><span class=\"token punctuation\">(</span>blurred_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Aplicamos o filtro de borramentos multiplas</span>\n    <span class=\"token comment\">// vezes para que o efeito seja mais visível</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        cv<span class=\"token operator\">::</span><span class=\"token function\">filter2D</span><span class=\"token punctuation\">(</span>\n            blurred_image<span class=\"token punctuation\">,</span> \n            blurred_image<span class=\"token punctuation\">,</span> \n            blurred_image<span class=\"token punctuation\">.</span><span class=\"token function\">depth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n            blur_filter\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Criando os sliders</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">namedWindow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Center x %d\"</span><span class=\"token punctuation\">,</span> center_slider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">createTrackbar</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token operator\">&amp;</span>center_slider<span class=\"token punctuation\">,</span>\n            center_slider_max<span class=\"token punctuation\">,</span>\n            on_trackbar_center_changed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">on_trackbar_center_changed</span><span class=\"token punctuation\">(</span>center_slider<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token operator\">::</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Decay x %d\"</span><span class=\"token punctuation\">,</span>  decay_slider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">createTrackbar</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token operator\">&amp;</span>decay_slider<span class=\"token punctuation\">,</span>\n            decay_slider_max<span class=\"token punctuation\">,</span>\n            on_trackbar_decay_changed <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">on_trackbar_decay_changed</span><span class=\"token punctuation\">(</span>decay_slider<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token operator\">::</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Range x %d\"</span><span class=\"token punctuation\">,</span>  range_slider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">createTrackbar</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token operator\">&amp;</span>range_slider<span class=\"token punctuation\">,</span>\n            range_slider_max<span class=\"token punctuation\">,</span>\n            on_trackbar_range_changed <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">on_trackbar_range_changed</span><span class=\"token punctuation\">(</span>range_slider<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span><span class=\"token function\">waitKey</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p><em>Para obter os argumentos de linha de comando, eu utilizei a biblioteca <a href=\"https://github.com/bfgroup/Lyra\">lyra</a>, mas você qualquer biblioteca de sua preferência.</em></p>\n<p>Este é o resultado obtido quando executamos o binário <a href=\"https://www.flickr.com/photos/romainguy/50386634128/in/dateposted-public/\">nessa imagem</a> com os parametros <em>center = 58</em>, <em>decay = 10</em> e <em>range = 45</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADkUlEQVQozyXS209aBwDH8YORJjNZsvRlw2bKuCkIHA4cDnDwMC5H7ncBQSgWcNwpoMAQKlQtdmqt7VaXmXVr67J6w6m0OkNbNJot62Kyh/0Ffdj7tmTvo9vv/ZPfyxcgEAgAAHxA6tZpLUw2HxTJeimMHjKNyYVFqMzpcgfDCbPNSaYyeLB4gMsfYLIYdHpbEYnENgSIxEs4rmPzYBaEkCl9LBAe4CEKXJstlKu1O0+2GrXFZQgW9bO5ICSABDACw1dIJOD/sVgcoQij9LEpNOZbyRVQ6f08AfLg4frjpzufLd3Vm2x8BJVicp/XjaJSHsgRCaDOzk6gq6tLJJJR25LO7CVTqYwBLoRI5TgoEHn8425/lC/WiOVWVDU8kS/ZRwJiTKvEdVKJpJv0PvBhDxnkIaTunl4yTak2lKozZptj1B8Sy80GxzimC7WV1JSdrHyenLonNSRxa0JhCCjUwzAPBJhMDo3OpFD72n9Ot3dhcVFvHkGHRg0jmUB6gYXnxfb5iVsbudqWyruiv3ZP472t984YRwsq5RDA5UIfUWggX2i02FB0UIiqJLgXdxay02tix0Jsbsec2XDm6vbMtjn5vSWxbop8aw5/pRtbcnrG2xhk9DEggQBFJXKlVqb1SYy5VPnrsdy6IbEZmG/y43uKZAMO/EDz7FL9DTRSt6Y39eFvotcrgADisdksjVqlUCpDkUxtce3ulzuV5QM8sukqHvPDz6D4kTB6NJj76XLuDWP+D3asqYjtqD5Zv56vAZgY5rD7BXwQhDHcGreFliKlp/6pA1v+2F58ZSmfDBVa0S9+++vvf6ov/rx6/wKL1NvnhtRWLJEDBhFICHFRKRpOFrTuG/rgqia2Ycw+Hy6+dE2faosnwtQrZfXCXDl/sPu7aaqJRPY16X13bitw1QPwWAyVDFUOGexjBaGxbIo9sWT3ncVje+kl/mkruvKr6caZKNNK3f/FNXvKCTWUmQYWrU/OPJIKOcDl9951WfR8sZaK+IzXluWBx5r0wcfZo+PXb6y3fgbjTffsuWfubHL1NRg9HEwfqiefWzLb1ekKsbPjbZ4qTGhzBjFbURdYBT2PrKWjK4G95NqFbe5cXz4dmT133DwzlFrqQlOd/1ER37298h0m4v1XNoHQ9c6laNBn8FaUwYeyyKYkWgeje0jq0Drdctw8tVZO7NUTW6Vlr7zQTTybWtxOjvvarqOD8C/AgTicTnG0TwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Imagem de um relógio com tilt shift aplicado\"\n        title=\"Imagem de um relógio com tilt shift aplicado\"\n        src=\"/static/b691a0940798738787decf380159c69e/6af66/watch-tilt-shift.png\"\n        srcset=\"/static/b691a0940798738787decf380159c69e/4dcb9/watch-tilt-shift.png 188w,\n/static/b691a0940798738787decf380159c69e/5ff7e/watch-tilt-shift.png 375w,\n/static/b691a0940798738787decf380159c69e/6af66/watch-tilt-shift.png 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Nós podemos ver que o efeito na imagem é bem similar ao do tilt-shift feito por lentes de câmeras profissionais, onde o centro da imagem está em foco e as bordas ficam borradas.</p>"}},"pageContext":{"slug":"opencv-tilt-shift","lang":"pt","language":"pt","i18n":{"language":"pt","languages":["en","pt"],"defaultLanguage":"en","routed":true,"resources":{"pt":{"about":{"About me":"Sobre mim","my-description":"Eu sou um estudante de Engenharia da Computação na Universidade Federal do Rio Grande do Norte. Tenho interesse sobre tópicos relacionados a desenvolvimento mobile para Android, mas também possuo como hobby o estudo de tópicos sobre Aprendizagem de Máquina e Sistemas Operacionais.","need-developer":"Precisa de um desenvolvedor?","contact-me":"Entre em contato comigo."},"bloglist":{"Blog":"Blog","blog-description":"Pequenos posts sobre tópicos de ciências da computação que eu achei interessante."},"contact":{"contact-info":"Informações de contato"},"footer":{"gatsby-credit":"Criado por {{creator}} usando","fireplace-icon":"Ícone de lareira","by":"por"},"header":{"Edu's coding fireplace":"Lareira de código do Edu","Home":"Home","Blog":"Blog","About":"Sobre","Contact":"Contato"},"home":{"hello":"Olá.","i-am":"Eu sou","my-place":"e este é o lugar onde eu expresso meus pensamentos sobre assuntos que envolvem programação.","my-goal":"Espero poder compartilhar informações úteis para o mundo, da mesma forma que fizeram por mim."},"projects":{"diversify":{"header":"Diversify - Gerador de playlists para o Spotify","content":"Um gerador de playlist para o Spotify que busca satisfazer mutualmente, da melhor forma possível, os gostos musicais de um grupo de usuários. O gerador usa um algoritmo de clustering para detectar padrões de gosto de cada usuário e para decidir qual musica está mais próxima do gosto músical coletivo dos usuários.\n\n Um website feito com Django e React está atualmente sendo desenvolvido para hospedar o algoritmo.","url":"https://github.com/edujtm/diversify"},"tuyo":{"header":"Tuyo - Gerenciador de playlists para o YouTube","content":"Um aplicativo nativo para Android feito utilizando Kotlin que permite o gerenciamento em grupo (i.e. copiar, colar e recortar) de playlists do YouTube. O aplicativo segue o guia de arquitetura do Android utilizando os componentes de arquitetura do Jetpack para gerenciar o ciclo de vida, injeção de dependências com Dagger e Espresso e JUnit para testes funcionais e unitários, respectivamente. \n\n Nesse projeto eu aprendi um pouco mais sobre como gerenciar o ciclo de vida dos componentes principais do Android, evitando problemas de memória, e como criar uma cache dos dados de uma API de terceiros.","url":"https://github.com/edujtm/tuyo"},"personal-website":{"header":"Site pessoal - Gatsby.js","content":"Este website foi desenvolvido utilizando Gatsby.js e GraphQL para obter um design responsivo e produzir conteudo gratuito para pessoas interessadas em programação. O site utiliza i18next para internacionalização de todo o conteúdo do site e está atualmente sendo migrado para TypeScript.","url":"https://github.com/edujtm/edujtm.github.io"}}}},"originalPath":"/blog/opencv-tilt-shift","path":"/pt/blog/opencv-tilt-shift"}}},"staticQueryHashes":["3159585216","3159585216","440568431"]}