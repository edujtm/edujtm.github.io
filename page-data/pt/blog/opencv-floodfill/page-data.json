{"componentChunkName":"component---src-templates-blog-js","path":"/pt/blog/opencv-floodfill","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Utilizando OpenCV flood fill como uma ferramenta de seleção","date":"16/10/2020"},"html":"<p>Devido a quantidade variada de padrões em uma imagem, não é simples selecionar regiões de interesse complexas na imagem de modo a fazer operações nelas. Nós precisamos de algum modo de fazer esta região se testacar do resto da figura, mas ainda precisamos lidar com ruídos, formas complexas na imagem e outros objetos que podem estar no meio do nosso objetivo.</p>\n<p>Uma forma de abordar esse problema é tentando gerar uma imagem binária que destaca as regiões da imagem que nós podemos estar interessados. Já que imagem binárias só possuem dois valores possíveis, nós podemos então utilizar todos os outros valores representáveis para marcar regiões para pós-processamento e agir de acordo com cada marcação. Assumindo que essas regiões sejam separadas pelo fundo da imagem, nós podemos usar <a href=\"https://docs.opencv.org/4.4.0/d7/d1b/group__imgproc__misc.html#gaf1f55a048f8a45bc3383586e80b1f0d0\">cv::floodFill()</a> para marcar as diferentes regiões que estamos interessados.</p>\n<p>A função <code class=\"language-text\">cv::floodFill()</code> funciona da mesma forma que a funcionalidade de \"balde\" que está presente emdiversos programas de manipulação de imagens disponíveis. Ela preenche todos os pixels vizinhos com intensidades similares ao do ponto inicial com uma nova intensidade especificada pelo usuário. A API disponível no OpenCV para o algoritmo flood fill é mostrada abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>\n\tcv<span class=\"token operator\">::</span>InputOutputArray image<span class=\"token punctuation\">,</span>       <span class=\"token comment\">// A imagem em qual uma região será preenchida com newVal</span>\n\tcv<span class=\"token operator\">::</span>Point seedPoint<span class=\"token punctuation\">,</span>              <span class=\"token comment\">// O ponto na imagem onde começar o preenchimento </span>\n\tcv<span class=\"token operator\">::</span>Scalar newVal<span class=\"token punctuation\">,</span>                <span class=\"token comment\">// A nova intensidade/cor </span>\n\tcv<span class=\"token operator\">::</span>Rect <span class=\"token operator\">*</span>rect <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// Um cv::Rect que define os limites da area preenchida</span>\n\tcv<span class=\"token operator\">::</span>Scalar lowDiff <span class=\"token operator\">=</span> <span class=\"token function\">Scalar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>     <span class=\"token comment\">// O limite de intensidade mínimo para um pixel ser preenchido </span>\n\tcv<span class=\"token operator\">::</span>Scalar highDiff <span class=\"token operator\">=</span> <span class=\"token function\">Scalar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// O limite de intensidade máximo para um pixel ser preenchido </span>\n\t<span class=\"token keyword\">int</span> flags                         <span class=\"token comment\">// Um número de flags que alteram o funcionamento do algoritmo (e.g. o tipo de conectividade)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><i>Existe uma outra definição dessa função que aceita uma máscara para selecionar quais pixels são preenchidos, mas que funciona da mesma forma. A máscara também tera as regiões pintadas na imagem como valores não-nulo após a execução do algoritmo.</i></p>\n<p>Vamos ver um exemplo de como nós podemos utilizá-la para selecionar regiões.</p>\n<h2 id=\"resolvendo-um-problema-de-marcação\" style=\"position:relative;\"><a href=\"#resolvendo-um-problema-de-marca%C3%A7%C3%A3o\" aria-label=\"resolvendo um problema de marcação permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resolvendo um problema de marcação</h2>\n<p>Digamos que, após processar uma imagem, nós obtemos a seguinte imagem binária com bolhas brancas dentro.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC4ElEQVQ4y41TPUiqYRR+Lf9INIOwH0PszzSxgorCSLAfIy1Is6GEBAU3iwLtP6JokGhoKAQXB9sCGzQIHILGHBrcbGqoIRpsMhq8j56v717u5V7uGb7ved/3vOc85zznZXV1dXd3dyqVqqam5vDwMB6Pj42NMcaqqqpYxQQCAb7Nzc3ZbHZnZ4c2PR7P5+cna21tDQaDv/ohyubmZn9/P7DBYDg+PtZoNMDV1dXs20QiES4ySoJjrCkbuESj0YmJCeDt7e1SqdTZ2UmXu7q6KNBPs9lsFxcXs7Ozv4WHKZVKnU5HWCqVFgqF9/f32tpaLAcGBsq7fX19Dw8Pfr+fPFZWVkZHR/8MBFtYWHA6nVTd9fU1k0gkYNvT04Nr2BIKhc/Pz2gbfxmtUqvVfHJ0AXSAcYVdXl6azWaqnELKZDKxWIw6af/09PTq6gpBgV0uF2iDKSfHzMzM2toaFpAhEAgA4Ca+GxsboVCIipqfn0dceMsqJpfLU6mU3W5n5+fnQ0NDcEomk29vb93d3USe/dNub29fXl4YlUq1LS0tNTQ0UJObmpqIG2SnWMiBXhJGp3K5HDcYoEoC0pnD4Xh6ejIajcD39/dWqxXA6/V+fHxgCijZyMgI11IU8PX11dHRQQdzc3PhcPjs7AwY+re1tVFcsOBnsZwVjcGvsbFxcXERu1tbW2gpxnt3d5cfTM610ryDg4OTkxNizjA0eBW8qiCMMaBu+3w+Skhji/vDw8MgNT4+zj2E6elp9t9G+fEKjo6OIpEIt9br9RQPhnlqb28HaGlpWV1dpebf3NzEYrH6+nos0YJEIpHJZCrUGdvf3y8Wi729vcCvr6+Pj48AqDydTgMoFAp47+3t8bouLy+73W7u0VsslvX1dfDBMbJNTU39jTPGFgPHbWm1WpPJxJ+RQdLy9H3LDp2ReXBwkErAeE1OTpb9QCafz2NIeD0gJl44CuYlgDylikE/2iS+PwDvkNUrAdKrAwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Imagem binária com regiões brancas\"\n        title=\"Imagem binária com regiões brancas\"\n        src=\"/static/b3c8f7ee7ad690e7b1e1a9cc828ae9ee/6f3f2/bolhas.png\"\n        srcset=\"/static/b3c8f7ee7ad690e7b1e1a9cc828ae9ee/4dcb9/bolhas.png 188w,\n/static/b3c8f7ee7ad690e7b1e1a9cc828ae9ee/6f3f2/bolhas.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Suponha que nós temos a tarefa de contar o número de bolhas da imagem, utilizando algum algoritmo de nossa escolha. Comos nós podemos resolver essa tarefa? é fácil contar as bolhas visualmente, mas não é simples dar essa mesma informação para o computador. Se nós tentarmos contar pixels brancos, nós precisamos ter certeza que não iremos contar a mesma região mais de uma vez. Para evitar isso, nós precisamos remover todos os outros pixels que pertence a uma região quando nós encontramos o primeiro pixel dela, para isso que é utilizado o flood fill.</p>\n<p>Essa ideia pode ser implementada da seguinte forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> objects_qnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\ncv<span class=\"token operator\">::</span>Mat image <span class=\"token operator\">=</span> <span class=\"token comment\">/* imagem binária */</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> image<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// Otimização que evita recalcular o deslocamento da linha em</span>\n\t<span class=\"token comment\">// todos os pixels</span>\n\tuchar<span class=\"token operator\">*</span> row_ptr <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>ptr<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> image<span class=\"token punctuation\">.</span>cols<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> row_ptr<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>row_ptr <span class=\"token operator\">==</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tcv<span class=\"token operator\">::</span>Point loc <span class=\"token punctuation\">{</span> j<span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t\t\tobjects_qnt<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token comment\">// Nos marcamos a região com objects_qnt</span>\n\t\t\tcv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> loc<span class=\"token punctuation\">,</span> objects_qnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>É importante notar que há uma troca de eixos entre as coordenadas da imagem (i, j) e a instanciação da classe <code class=\"language-text\">cv::Point { j, i }</code>. A notação de matriz possui indexação (linha, coluna) enquanto o ponto possui uma representação com x para horizontal e y para vertical. Essa mudança é ilustrada abaixo:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 605px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.42553191489361%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABWElEQVQ4y5VT2ZKDIBD0/78vL3ncZNWkXC5Fw907kI3FGrMHVV0gzDTd49AstwChHNTokdc+JMxLwMAsPriDpP3/jCbGhAe8jxi4BZcGH9JCjBbvlwXGefgUYa1d4Zwr8N5/Q1OzO59IrcGkBOZLh6nvoK89VNuCH4+YtcayLJjnucw1jDEYhuFOaGwkVQ6jDuBEqAVHYBxICQihzJFIEiX9NKZpuhNGSghUu6KQbBZCpZDyGdnKSERcZordw0r4+MjjZiLeWrJDloMakWKEH0d4KRHIVqwU1nmPtaaSNPWGJ4WMfsbEBnjOd23ViraEubbNdpOqBXm9wp5OxfKetVcKV8I6OLeCpgPqo2J5m/wkoMpdLdcBjnopF/eVvT3C+HXxPiEp3BL+hqe22RLmWvx1dF2Hw+GAIzU+Y+yZMD+ffJBvU9SLGZLaRgixixzb9z3O5zNaelGftuj8MXeOJREAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Mudança de eixos entre matriz e ponto\"\n        title=\"Mudança de eixos entre matriz e ponto\"\n        src=\"/static/431cd2520fb32ef27a207b4122c096fc/90cbd/opencv-axis.png\"\n        srcset=\"/static/431cd2520fb32ef27a207b4122c096fc/4dcb9/opencv-axis.png 188w,\n/static/431cd2520fb32ef27a207b4122c096fc/5ff7e/opencv-axis.png 375w,\n/static/431cd2520fb32ef27a207b4122c096fc/90cbd/opencv-axis.png 605w\"\n        sizes=\"(max-width: 605px) 100vw, 605px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>A implementação acima irá contar todas as bolhas dentro da figura e deixará elas marcadas para pós processamento. O problema aqui é que não podemos contar mais que o limite máximo representavel por um tipo <strong>unsigned char</strong>. Assim que chegarmos a 255 objetos, a região será repintada em branco e contada multiplas vezes.</p>\n<p>Para evitar isso, precisamos convert a imagem para outro tipo, mas <code class=\"language-text\">cv::floodFill()</code> funciona apenas com imagens do tipo <strong>inteiro 8 bits</strong> e <strong>ponto flutuante</strong>. Dadas essas opções, nós podemos escolher o tipo <strong>float</strong> que nós dará um limite grande para contagem. o OpenCV nos dá a função <a href=\"https://docs.opencv.org/4.4.0/d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b\">Mat::convertTo()</a> que modifica o tipo usado para representar dados na imagem, mas não redimensiona os valores para a nova faixa. Com essas restrições, nos chegamos a seguinte solução:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">/*\n * O template é utilizado aqui para que possamos redimensionar vários tipos de dado.\n */</span>\n<span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">DataType</span><span class=\"token operator\">></span>\ncv<span class=\"token operator\">::</span>Mat <span class=\"token function\">rescale_intensities</span><span class=\"token punctuation\">(</span>cv<span class=\"token operator\">::</span>Mat input<span class=\"token punctuation\">,</span> DataType new_min<span class=\"token punctuation\">,</span> DataType new_max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static_assert</span><span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span>is_arithmetic<span class=\"token operator\">&lt;</span>DataType<span class=\"token operator\">></span><span class=\"token operator\">::</span>value<span class=\"token punctuation\">,</span> <span class=\"token string\">\"data type for rescaling intensities must be numeric\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat temp <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">double</span> input_min<span class=\"token punctuation\">,</span> input_max<span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">minMaxLoc</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>input_min<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>input_max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat result <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>new_max <span class=\"token operator\">-</span> new_min<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>temp <span class=\"token operator\">-</span> input_min<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>input_max <span class=\"token operator\">-</span> input_min<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> new_min<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* código para processamento da imagem */</span>\n\n    <span class=\"token comment\">// O modo que nós contamos o objeto é dependente do</span>\n    <span class=\"token comment\">// tipo de dado utilizado para representar a imagem.</span>\n    <span class=\"token comment\">// A quantidade máxima de objetos que nós podemos contar</span>\n    <span class=\"token comment\">// é definida pela valor máximo representável pelo tipo.</span>\n    cv<span class=\"token operator\">::</span>Mat float_image <span class=\"token operator\">=</span> <span class=\"token comment\">/* alguma imagem binária */</span><span class=\"token punctuation\">;</span>\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>float_image<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// convertTo apenas modifica o tipo, nós ainda precisamos</span>\n    <span class=\"token comment\">// redimensionar as intensidades da imagem.</span>\n    cv<span class=\"token operator\">::</span>Mat rescaled_image <span class=\"token operator\">=</span> <span class=\"token function\">rescale_intensities</span><span class=\"token punctuation\">(</span>int_image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0.</span><span class=\"token punctuation\">,</span> std<span class=\"token operator\">::</span><span class=\"token class-name\">numeric_limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* código para pós processamento da imagem */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Isso mapeia a intensidade antiga para a faixa de valores inteira que o tipo float consegue representar.\nO mapeamento é feito pela seguinte função:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow></mfrac><mo>+</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">  f(x, a, b)  = \\frac{(b - a) (x - x_{min})}{x_{max} - x_{min}} + a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.263em;vertical-align:-0.8360000000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.3139999999999996em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8360000000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></span>\n<p>Que mapeia um valor <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> com valor mínimo <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">x_{min}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> e valor maximo <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">x_{max}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> para um nova faixa de valores entre <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> e <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>. Nós podemos observar que caso <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> seja igual a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">x_{min}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, o resultado será igual a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> e caso <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> seja igual a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">x_{max}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, então o resultado será igual ao novo valor máximo <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>. Ao mapear para uma nova faixa de valores, nos evitamos qualquer problema que ocorreria quando o contador chegasse em 255, que é o valor utilizado na faixa antiga.</p>\n<p>Com isso, nós chegamos a solução final para o problema de contagem de bolhas:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cv<span class=\"token operator\">::</span>Mat float_image <span class=\"token operator\">=</span> <span class=\"token comment\">/* imagem binária */</span><span class=\"token punctuation\">;</span>\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>float_image<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat rescaled_image <span class=\"token operator\">=</span> <span class=\"token function\">rescale_intensities</span><span class=\"token punctuation\">(</span>int_image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0.</span><span class=\"token punctuation\">,</span> std<span class=\"token operator\">::</span><span class=\"token class-name\">numeric_limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">float</span> object_qnt <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> image<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">float</span><span class=\"token operator\">*</span> row_ptr <span class=\"token operator\">=</span> rescaled_image<span class=\"token punctuation\">.</span>ptr<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> image<span class=\"token punctuation\">.</span>cols<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> row_ptr<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>row_ptr <span class=\"token operator\">-</span> std<span class=\"token operator\">::</span><span class=\"token class-name\">numeric_limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          cv<span class=\"token operator\">::</span>Point loc <span class=\"token punctuation\">{</span> j<span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n          object_qnt<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n          cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> loc<span class=\"token punctuation\">,</span> objects_qnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    std<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"The figure has \"</span> <span class=\"token operator\">&lt;&lt;</span> object_qnt <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" bubbles.\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token operator\">::</span>endl<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n  <br/>\n<p>Note que nós estamos agora utilizado uma igualdade por aproximação devido à erros de arrendondamento em tipos ponto flutuante. Executar o binário nos dá o resultado:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=edujtm data-host=localhost></span><span></span></span>./build/labeling <span class=\"token punctuation\">..</span>/bubbles.png\nThe figure has <span class=\"token number\">32</span> bubbles.</code></pre></div>\n<br/>\n<p>Se nos convertemos a imagem para <strong>unsigned char</strong> e mostrarmos com <code class=\"language-text\">cv::imshow()</code>, nós obtemos a seguinte imagem:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABS0lEQVQ4y42T226EMAxEQ7mUOwiEViAhxP//ZA+YdUy6qPXDrgnjmbEdnHMuiiJ3RvQO9ym+zlBkkiQfYS6OY6HgVwuC8BqBGqxyQmWapoG10A+IvxWc+z5Dq64/jrCqsk9Etm1lcRZdFEWWZVbZ2gapHR1Q1bQ+eSfzRCHPcx1kWZZeCYTogLCC2p6y2F1WVcWYjhpR5rnv+8DFUwBu2/bmFmWxZNerDaPvh+Rc0zS3SWoOi7rouu5w+D60XB49TZN65pFBMhvJnzZ3uNdVk1BAgpQUB2WogfeGX69XYFhYKLYdSkDKoV+KXc//o65rr28nGZ8hiTTFkIZhYFrikXOmyMm1CWiWZZGpkszzLPdkHEcpphKMjpqm9NodOJwIjsS/+BV4lC3crmfQEtz6CBcWBIZzlnqx42ddV/vRkgdfCx3u+75tG4nV+AG29w6GWas+7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Imagem com regiões marcadas\"\n        title=\"Imagem com regiões marcadas\"\n        src=\"/static/a17115a22d9c1813e02057ee38240970/6f3f2/labelled-bubbles.png\"\n        srcset=\"/static/a17115a22d9c1813e02057ee38240970/4dcb9/labelled-bubbles.png 188w,\n/static/a17115a22d9c1813e02057ee38240970/6f3f2/labelled-bubbles.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Nos podemos ver uma variação bem leve de intensidade entre as regiões marcadas e o fundo da imagem. Mostrar a imagem dessa forma só funciona pois existem menos de 255 bolhas nela. Se a imagem tivesse mais que isso, nós teriamos que redimensionar as intensidades para a faixa [0.0, 1.0], mas não haveria muita informação visual. O valor da marcação na imagem se dá pelo seu uso em outros passos de processamento posteriores, que nós iremos ver na próxima seção.</p>\n<h2 id=\"contando-buracos-utilizando-flood-fill-em-uma-pipeline\" style=\"position:relative;\"><a href=\"#contando-buracos-utilizando-flood-fill-em-uma-pipeline\" aria-label=\"contando buracos utilizando flood fill em uma pipeline permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contando buracos: utilizando flood fill em uma pipeline</h2>\n<p>Nós estamos felizes com nosso contador de bolhas, mas uma nova tarefas nos foi dada: nós precisamos contar o número de buracos dentro das bolhsa, já que eles representam falhas de manufatura. Nós podemos assumir que: </p>\n<ul>\n<li>Nós não precisamos cnotar bolhas que tocam a borda da imagem</li>\n<li>Objetos com mais de um buraco podem existir</li>\n</ul>\n<p>Do contador de bolhas que nós desenvolvemos, nós já sabemos como contar e marcar as bolhas, mas agora nós precisamos de alguma forma detectar os buracos dentro delas. Nós sabemos que quatros invariantes existem após o processo de marcação:</p>\n<ol>\n<li>O fundo da imagem terá intensidade igual a 0</li>\n<li>As bolhas terão intensidade diferente de 0</li>\n<li>Os buracos também terão intensidade igual a 0</li>\n<li>Buracos são rodeados por pixels de bolhas, senão eles seriam parte do fundo da imagem</li>\n</ol>\n<p>Do segundo e quarto pontos, nós podemos deduzir um algoritmo que encontra buracos: Se nós acharmos um pixel com intensidade igual a 0, nós checamos se o pixel a esquerda possui intensidade diferente de 0. Se isso for verdadeiro, então nós encontramos um buraco. Nós não queremos repetir essa checagem em todos os pixels do background, então nós podemos pintar o background com o maior valor possível, desse modo apenas os buracos terão intensidade igual a 0. É preciso também ter cuidado para nao ler pixels fora da borda, mas já que não é necessário contar bolhas na borda, nós podemos retirá-las de modo que todos os pixels da borda farão parte do fundo e logo serão pintados de branco.</p>\n<p>Vamos ver como podemos implementar isso passo a passo.</p>\n<h3 id=\"removendo-pixels-da-borda\" style=\"position:relative;\"><a href=\"#removendo-pixels-da-borda\" aria-label=\"removendo pixels da borda permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Removendo pixels da borda</h3>\n<p>Remover bolhas da borda não é muito complexo: se nós acharmos qualquer pixel branco na borda da imagem, nó pintamos de preto utilizando flood fill. Um modo de implementar isso é mostrado abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">/* template para legibilidade (std::numeric_limits é um nome um pouco longo) */</span>\n<span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">T</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">using</span> limits <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span>numeric_limits<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">remove_bubbles_at_border</span><span class=\"token punctuation\">(</span>cv<span class=\"token operator\">::</span>Mat_<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> input<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> input<span class=\"token punctuation\">.</span>cols<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Remove bolhas que tocam a borda de cima</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>at<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            cv<span class=\"token operator\">::</span>Point location <span class=\"token punctuation\">{</span> i<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// Remove bolhas que tocam a borda de baixo</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>at<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>rows <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            cv<span class=\"token operator\">::</span>Point location <span class=\"token punctuation\">{</span> i<span class=\"token punctuation\">,</span> input<span class=\"token punctuation\">.</span>rows <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> input<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Remove bolhas que tocam a borda esquerda</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>at<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            cv<span class=\"token operator\">::</span>Point location <span class=\"token punctuation\">{</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// Remove bolhas que tocam a borda direita</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>at<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> input<span class=\"token punctuation\">.</span>cols <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            cv<span class=\"token operator\">::</span>Point location <span class=\"token punctuation\">{</span> input<span class=\"token punctuation\">.</span>cols<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Após aplicar essa função na imagem, esse é o resultado obtido:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACOElEQVQ4y5VUy4vpYRh2JzTIQi6Ncr8UahakLFyiSLmkZKOoWVIKQ4qNlSxspGz8ASxHzdrSxh9gZWOhWbBSFs5z5i1mHM7pvIuf5+t7r8/7fBgMBoPJZLLZbHwZ/zIOhwPP+3cULxQK397eXl5egK1Wa7fbfX5+vtzeGpJptVpkpaNEIhmNRqFQCLjZbJ7PZ5PJRG5ms5kSXQ1+w+EwHo+Tx/crqVRKkTCBQLDf7z8/P5+enq6NOJ3O5XJZLBbJo1Qq+Xy+PxPBMplMMpm8bdvhcCCMKNlsNpPJ5BKsUqnUavWlOFjAXNfKFyYIiEQiHo9nNBq9Xi+O/X5/Op0SI6lUCm27XC5gFovFuPzU6/XX11cARNKxWq0CwDWdTiMv3LAIKnu7odlsttvtbDYbNf9o1cwvuw3GbLlcTqFQEMlKpZKaQjXK5Xa7weUdkaBVWiD5xWKx9Xptt9uBF4uF3+8HyOfzh8NBJpNdaaJM0Wj0dDoZDAbKlUgkarXaYDAAxv51Oh3lRRd3BkaT2WwWoNFogNJAINBqtb4Lk9xAXqfT6fV6t2olztEwyQBsFwoFKkhX8PZ4PGgqGAw+lPp/GCWwWCyUDwY96fV6AI1GUy6Xifz5fD4ej+VyOfF/faL4ttvt4/EIkQNvt9vVagWAyd/f3wHEYjEEixfG5/N/NEzz4CVUKhUulwv1olokEnnUIzaC5/EXFf1eKZZ3FfAXoADI8+PjA039oPryT4SRwuEwBn5EKekc4BfWDY2pu3q1uAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"imagem com bolhas na borda removidas\"\n        title=\"imagem com bolhas na borda removidas\"\n        src=\"/static/6f624eea650b0b4c0f519f330280a213/6f3f2/remove-border.png\"\n        srcset=\"/static/6f624eea650b0b4c0f519f330280a213/4dcb9/remove-border.png 188w,\n/static/6f624eea650b0b4c0f519f330280a213/6f3f2/remove-border.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"contando-e-marcando-bolhas\" style=\"position:relative;\"><a href=\"#contando-e-marcando-bolhas\" aria-label=\"contando e marcando bolhas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contando e marcando bolhas</h3>\n<p>Agora nós precisamos contar e marcar as bolhas. Nós já fizemos isso na primeira parte deste artigo, então nós vamos apenas mover a implementação para uma função.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">float</span> <span class=\"token function\">count_and_label_bubbles</span><span class=\"token punctuation\">(</span>cv<span class=\"token operator\">::</span>Mat_<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> input<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> width <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span>cols<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> height <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Point p <span class=\"token punctuation\">{</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">float</span> object_qnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> height<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">float</span><span class=\"token operator\">*</span> row_ptr <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span>ptr<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> width<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> row_ptr<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>row_ptr <span class=\"token operator\">-</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    object_qnt<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                    p<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> j<span class=\"token punctuation\">;</span>\n                    p<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span>\n                    cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> object_qnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> cv<span class=\"token operator\">::</span>Exception<span class=\"token operator\">&amp;</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        std<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Exception occurred: \"</span> <span class=\"token operator\">&lt;&lt;</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">what</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token operator\">::</span>endl<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> nobjects<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Com o resultado após esse passo sendo similar ao que obtemos na primeira parte:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA2ElEQVQ4y62SUQ6DMAxDGS0wECDU+x92T7UUddBQpC1foYkdx6Hr/h6vHJa3u6vgksVFhhD6vm8qCjnuwCTetPp7+RpjLOlPytsWqEla4BqGwUSN41jB00FfOV+fxnIXUM7z/MQ21/ObC8Fr+rtrrTyJqSCRf2xBXlmYwrZthqebIdM0qdTYBT7ZAwCYwFdjeX/nqLOYySfzS0XX9x9ClOacHCLR2ohf13VZFrvFFxgbU0rCkBzHoRXAqBukuypjVaOPxL1n1ig5boDHau8u+7677JRBPvlPP/hmBeBvPP8kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Imagem marcada sem bolhas na borda\"\n        title=\"Imagem marcada sem bolhas na borda\"\n        src=\"/static/1ba6c329ded9ed45c0f17f78954594be/6f3f2/labeled-without-border.png\"\n        srcset=\"/static/1ba6c329ded9ed45c0f17f78954594be/4dcb9/labeled-without-border.png 188w,\n/static/1ba6c329ded9ed45c0f17f78954594be/6f3f2/labeled-without-border.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>A imagem parece ser totalmente escura, mas existem bolhas marcadas dentro dela.</p>\n<h3 id=\"pintando-o-fundo-de-branco\" style=\"position:relative;\"><a href=\"#pintando-o-fundo-de-branco\" aria-label=\"pintando o fundo de branco permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pintando o fundo de branco</h3>\n<p>Já que nós sabemos que não existem bolhas na borda, nós podemos assumir que todos os pixels da borda fazem parte do fundo da imagem. Se nós fizermos um flood fill em qualquer um deles, o fundo da image se tornará da cor escolhida. Escolheremos o canto superior esquerdo.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">fill_background</span><span class=\"token punctuation\">(</span>cv<span class=\"token operator\">::</span>Mat_<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> input<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cv<span class=\"token operator\">::</span>Point top_right <span class=\"token punctuation\">{</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> top_right<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Após esse passo, nós temos uma imagem como essa:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACRklEQVQ4y51US6upYRQ2YGjEwMQvMPADDMwM8APMDAz8AGVgurPJiKJMFAMKkURoh4iSFBm4ZkCRywCx3bbLefZZ+r5v79Sp8w5Wz+ddt2c968V7PB73+/16vcI+/nW+vr7gyXzyuHcU//n5abPZGo0GcLfbtVgs4/GYueWC7+Db7bZarZiU6/XaaDR+fHwAW61WHo83GAyA4dDr9SgRG5zJZPh8fiQSIQ9ueiTq9/uEj8ejUCgUiUTb7ZYcvoNbrRbSu91u8nC5XOVymZuIOeFwOB6P/6gMJzR2Op1oJFKpVK/XE4adz+eLxYK8kbrT6Ww2G7byr0ns9/vz+Yx0lUoFnzqdTiaTkUMsFkPbzWaTJvUcGOzb25vH4wFAJKzdbnc4HADVatXn85EbhKCyP6YNq1QqmcFSwy/P/e9hg+ljNpsFg0Gih/TL5ZLGgWqUq1arYZZUiUKeS4JpkYCXywU2kUiIxWKIBKxQKAqFAoDf74dU2Ag2mPRIp9MCgWA4HFIuaA4KGo0GOJlMjkYj4nI4HLgUeEzPoVAI4P39PRqN1ut1BEOz3W7H5VkqlbRardlsZqdNh8ikUilaA0zb6/VSQVxRcC6XM5lMxOKp83+fZ9t4PcVikX6aTqdEcjKZOJ1O2nCVSmUwGDAtbAHm/wwmGUADJNvtNrBEIpHL5QD5fF6tVgOAORYWL4xWmNWZqKIs3jB0wvaiWjabfbkesFAEWlDJ15wDgQDEY6ZIgAKwP6CApthg3DH/RKCEyiDM7fBXC5T0DxK9FCWceLW4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Imagem das bolhas com fundo branco\"\n        title=\"Imagem das bolhas com fundo branco\"\n        src=\"/static/fb15a3929e61ee52311a9667f7f7f8cc/6f3f2/white-background-bubbles.png\"\n        srcset=\"/static/fb15a3929e61ee52311a9667f7f7f8cc/4dcb9/white-background-bubbles.png 188w,\n/static/fb15a3929e61ee52311a9667f7f7f8cc/6f3f2/white-background-bubbles.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"contando-buracos\" style=\"position:relative;\"><a href=\"#contando-buracos\" aria-label=\"contando buracos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contando buracos</h3>\n<p>Agora nós temos tudo necessário para contar os buracos. Os únicos pixels que ainda são iguais a 0 são aqueles que pertence aos buracos então nós podemos repetir o mesmo processo que usamos ao contar bolhas: se nós acharmos um pixel igual a 0, aumentamos o contador e utilizamos o flood fill para remover a região. Nós também iremos remover a bolha, para que possamos ver quais bolhas foram removidas.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">float</span> <span class=\"token function\">count_holes</span><span class=\"token punctuation\">(</span>cv<span class=\"token operator\">::</span>Mat_<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> input<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">float</span> nholes <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> input<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">float</span><span class=\"token operator\">*</span> row_ptr <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span>ptr<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> input<span class=\"token punctuation\">.</span>cols<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> row_ptr<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>row_ptr <span class=\"token operator\">-</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                cv<span class=\"token operator\">::</span>Point location <span class=\"token punctuation\">{</span> j<span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Nós não precisamos lidar com bordas</span>\n                <span class=\"token comment\">// já que removemos as bolhas de lá</span>\n                cv<span class=\"token operator\">::</span>Point previous <span class=\"token punctuation\">{</span> j<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n                cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                cv<span class=\"token operator\">::</span><span class=\"token function\">floodFill</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> previous<span class=\"token punctuation\">,</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                nholes<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> nholes<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Após executar esse passo da pipeline, nós podemos ver que as bolhas com buracos foram removidas.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABr0lEQVQ4y5VTu4rCQBSdxlIs7AS/wS+wtfEjUvoP6UVkK79AbQQDWoiCEExhYyOki6IoKKiFhQq+H9k961mG2TjC7i2Gk8w999x7TyI+/xO32+1+v8tHod75vo/zcDjkcrl+vw88GAxM05zNZvJWBRryZrPJZDK2bQNns1khxGg0AobmcDhkIQ1ZW4hMxOl0CofD0Wh0t9sxQQSyL5dLoVDodruUClSsVqv1el2jTDJWEo/HDcMgGS9ZgrcQ9zxvu90GlWXGfr+HPrrt9XryJUvUajW07bou8OPxEFo/cH48A+B6vUo+jKDsr7ZxDY5MQlX/GQFviPVWvQaqHI9HnMCYArskJv+HjCHhITtUN4RIJpOO4wCUSqVIJCK39U1marPZDIVC0+mUamq3jUZjMplwnPV6rfYlmLFcLiuVCkA+ny8Wi1qTX0Oo4+FstVrwg48cgftjI7Kpt9v+e2g+ksViweFXqxXWS9vVHOl88PM8n8+xWCyRSAB3Op10Oh3wWa8sf2aotdvtd//ZeDy2LIvt6D+ScrmMzam2STJ8TqVSaEpPhjiU5/P5u4bl2r8Am8ha/17EV08AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Imagem com fundo branco e buracos removidos\"\n        title=\"Imagem com fundo branco e buracos removidos\"\n        src=\"/static/ab35c85a2744fa67b2883ec6d0f8da47/6f3f2/removed-holes.png\"\n        srcset=\"/static/ab35c85a2744fa67b2883ec6d0f8da47/4dcb9/removed-holes.png 188w,\n/static/ab35c85a2744fa67b2883ec6d0f8da47/6f3f2/removed-holes.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"a-pipeline-completa\" style=\"position:relative;\"><a href=\"#a-pipeline-completa\" aria-label=\"a pipeline completa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A pipeline completa</h3>\n<p>O último passo é apenas executar as funções em ordem.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">auto</span> config <span class=\"token operator\">=</span> <span class=\"token function\">parse_cli</span><span class=\"token punctuation\">(</span>argc<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat image <span class=\"token operator\">=</span> cv<span class=\"token operator\">::</span><span class=\"token function\">imread</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>input_path<span class=\"token punctuation\">,</span> cv<span class=\"token operator\">::</span>IMREAD_GRAYSCALE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>image<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        std<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Couldn't load specified image\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token operator\">::</span>endl<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    cv<span class=\"token operator\">::</span>Mat cloned_image <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// faz a conversão de tipo e intensidade</span>\n    cloned_image<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cloned_image <span class=\"token operator\">=</span> <span class=\"token function\">rescale_intensities</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0.</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Inicia a pipeline (todas as operações assumem tipo ponto flutuante 32 bits)</span>\n    <span class=\"token function\">remove_bubbles_at_border</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">float</span> nobjects <span class=\"token operator\">=</span> <span class=\"token function\">count_and_label_bubbles</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token function\">fill_background</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">,</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">float</span> nholes <span class=\"token operator\">=</span> <span class=\"token function\">count_holes</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat visible_image <span class=\"token operator\">=</span> <span class=\"token function\">rescale_intensities</span><span class=\"token punctuation\">(</span>cloned_image<span class=\"token punctuation\">,</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span>uchar<span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">limits</span><span class=\"token operator\">&lt;</span>uchar<span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"The figure has \"</span> <span class=\"token operator\">&lt;&lt;</span> nobjects <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" bubbles\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token operator\">::</span>endl<span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"The figure has \"</span> <span class=\"token operator\">&lt;&lt;</span> nholes <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" holes.\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token operator\">::</span>endl<span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">imshow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"initial_image\"</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">imshow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> visible_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">waitKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>O que nos dá o resultado esperado:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=edujtm data-host=localhost></span><span></span><span></span></span>./build/count_holes <span class=\"token punctuation\">..</span>/bubbles.png\nThe figure has <span class=\"token number\">21</span> bubbles.\nThe figure has <span class=\"token number\">7</span> holes.</code></pre></div>\n<br/>\n<h2 id=\"conclusão\" style=\"position:relative;\"><a href=\"#conclus%C3%A3o\" aria-label=\"conclusão permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Espero que esse exemplo ajude a esclarecer como podemos utilizar flood fill para marcar regiões de intensidade similar para pós processamento. Nós podemos combinar passos de pré-processamento como, por exemplo, aplicar um filtro canny para tentar separar regiões e então usar flood fill para marcá-las para processamento posterior. Um exemplo disso onde isto poderia ser útil seria na simulação de um efeito tela verde, onde nós marcariamos todos os pixels verdes com um valor constante e então trocariamos eles por um fundo de imagem alternativo. Em suma, o algoritmo flood fill pode ser utilizado para mais que simplesmente pintar seções da imagem quando utilizado em uma pipeline de processamento.</p>"}},"pageContext":{"slug":"opencv-floodfill","lang":"pt","language":"pt","i18n":{"language":"pt","languages":["en","pt"],"defaultLanguage":"en","routed":true,"resources":{"pt":{"about":{"About me":"Sobre mim","my-description":"Eu sou um estudante de Engenharia da Computação na Universidade Federal do Rio Grande do Norte. Tenho interesse sobre tópicos relacionados a desenvolvimento mobile para Android, mas também possuo como hobby o estudo de tópicos sobre Aprendizagem de Máquina e Sistemas Operacionais.","need-developer":"Precisa de um desenvolvedor?","contact-me":"Entre em contato comigo."},"bloglist":{"Blog":"Blog","blog-description":"Pequenos posts sobre tópicos de ciências da computação que eu achei interessante."},"contact":{"contact-info":"Informações de contato"},"footer":{"gatsby-credit":"Criado por {{creator}} usando","fireplace-icon":"Ícone de lareira","by":"por"},"header":{"Edu's coding fireplace":"Lareira de código do Edu","Home":"Home","Blog":"Blog","About":"Sobre","Contact":"Contato"},"home":{"hello":"Olá.","i-am":"Eu sou","my-place":"e este é o lugar onde eu expresso meus pensamentos sobre assuntos que envolvem programação.","my-goal":"Espero poder compartilhar informações úteis para o mundo, da mesma forma que fizeram por mim."}}},"originalPath":"/blog/opencv-floodfill","path":"/pt/blog/opencv-floodfill"}}},"staticQueryHashes":["3159585216","3159585216","440568431"]}