{"componentChunkName":"component---src-templates-blog-js","path":"/blog/opencv-tilt-shift","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Simulating a tilt-shift effect with OpenCV","date":"06/12/2020"},"html":"<p>Professional photographers are always looking for effects that highlight interesting portions of a scenery, to achieve that goal they use their mastery of scenery illumination together with some fancy camera lenses that enables them to achieve a desired effect, such as highlighting a person on the foreground, while blurring the background around them. </p>\n<p>Since those cameras require a very complex engineering process to be made, their price is often very expensive, which might keep some aspiring photographers away from the practice. Luckily we can simulate some of these effects in a computer using image processing techniques, this allow us to try out effects without having to buy one of those cameras. </p>\n<p>One interesting effect we can try out is called tilt-shift, which is the result of tilting the camera lenses with relation to the camera sensor in such a way that only a subsection of the scenery is focused. This effect is famous for making the picture look like its a photo of miniature world. Some of these effects can be seen in the images below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQP/2gAMAwEAAhADEAAAAUetclzDeG//xAAaEAACAwEBAAAAAAAAAAAAAAABAgMEERIj/9oACAEBAAEFAo4zwUbHrybVfyIRQzaf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABURAQEAAAAAAAAAAAAAAAAAAAAS/9oACAECAQE/AVv/xAAaEAACAgMAAAAAAAAAAAAAAAAAAREyEiEx/9oACAEBAAY/Ap02J2kqiqG8Th//xAAbEAACAwEBAQAAAAAAAAAAAAABEQAhMUFhof/aAAgBAQABPyEog8TyIBYIQp/pHVBars7DnHAcirZ//9oADAMBAAIAAwAAABA3D//EABcRAAMBAAAAAAAAAAAAAAAAAAARMVH/2gAIAQMBAT8QeQQ//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERITH/2gAIAQIBAT8Q64zOQ//EABwQAQEAAgMBAQAAAAAAAAAAAAERACExUWFBsf/aAAgBAQABPxBYDAXPmk1mxY4KohfzNxdLxMHjFrs7fcGBUlqF4p1iNfIfzP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Construction workers image with tilt shift applied\"\n        title=\"Construction workers image with tilt shift applied\"\n        src=\"/static/faa02817e41d9393fd7cf20e67265396/acb04/tilt-shift-1.jpg\"\n        srcset=\"/static/faa02817e41d9393fd7cf20e67265396/bc01b/tilt-shift-1.jpg 188w,\n/static/faa02817e41d9393fd7cf20e67265396/bf173/tilt-shift-1.jpg 375w,\n/static/faa02817e41d9393fd7cf20e67265396/acb04/tilt-shift-1.jpg 750w,\n/static/faa02817e41d9393fd7cf20e67265396/ec605/tilt-shift-1.jpg 1125w,\n/static/faa02817e41d9393fd7cf20e67265396/c58a3/tilt-shift-1.jpg 1500w,\n/static/faa02817e41d9393fd7cf20e67265396/c83bb/tilt-shift-1.jpg 4608w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABXVAvLSJCP//EABgQAQEBAQEAAAAAAAAAAAAAAAECAAMh/9oACAEBAAEFAi/B00VMhutM0Lv/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAECEiH/2gAIAQIBAT8BqKCen//EAB4QAAIBAwUAAAAAAAAAAAAAAAERAAIQIRIxQVGh/9oACAEBAAY/Am8Tfhx6vYB3VCAcO3//xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhQWH/2gAIAQEAAT8hLvNQu6SPT5iEMUMci5qxwmFQd//aAAwDAQACAAMAAAAQly//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EHBaw//EABgRAAMBAQAAAAAAAAAAAAAAAAABESEx/9oACAECAQE/EL6IVT0//8QAHBABAAICAwEAAAAAAAAAAAAAAQARIUExUXHh/9oACAEBAAE/EDPWARX7HGnAgaJ3ec6iSvTRlqjkDaUYvncuTPQ66lwIDgPCf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A picture of houses in a neighbourhood with tilt shift effect\"\n        title=\"A picture of houses in a neighbourhood with tilt shift effect\"\n        src=\"/static/23bfa798d567f0778db4079478e8a31e/acb04/tilt-shift-2.jpg\"\n        srcset=\"/static/23bfa798d567f0778db4079478e8a31e/bc01b/tilt-shift-2.jpg 188w,\n/static/23bfa798d567f0778db4079478e8a31e/bf173/tilt-shift-2.jpg 375w,\n/static/23bfa798d567f0778db4079478e8a31e/acb04/tilt-shift-2.jpg 750w,\n/static/23bfa798d567f0778db4079478e8a31e/ec605/tilt-shift-2.jpg 1125w,\n/static/23bfa798d567f0778db4079478e8a31e/c58a3/tilt-shift-2.jpg 1500w,\n/static/23bfa798d567f0778db4079478e8a31e/93719/tilt-shift-2.jpg 4000w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The goal of this post is to try to simulate this effect in post-processing with OpenCV. This simulation might not give all the features you would get with professional camera lenses, but its a interesting way of seeing what image processing is able to do.</p>\n<h2 id=\"understanding-how-to-do-it\" style=\"position:relative;\"><a href=\"#understanding-how-to-do-it\" aria-label=\"understanding how to do it permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Understanding how to do it</h2>\n<p>To achieve the effect we need to notice that the original image is blurred in some sections and left unprocessed in others. If you have read the article about <a href=\"/blog/opencv-spatial-filters\">spatial filters</a> before, you know that we can blur a picture by applying a smoothing filter, which gives part of the effect we want. </p>\n<p>After applying the filter, we have a blurred image together with the non-processed original image. We just need to find a way to blend them such that the effect is similar of the tilt shift. The way we do blending in OpenCV is by means of the <a href=\"https://docs.opencv.org/4.4.0/d2/de8/group__core__array.html#gafafb2513349db3bcff51f54ee5592a19\">cv::addWeighted()</a> function, which does an elementwise addition of the two images using a specified weight for each. The mathematical operation it implements is given below:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>α</mi><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>1</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>β</mi><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\tdst(I) = \\alpha \\cdot src_{1}(I) + \\beta \\cdot  src_{2}(I) + \\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span></span>\n<p>Where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">dst</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span></span></span></span> represents the destination image, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">src_{1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">src_{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> are the input images and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span> are user defined coefficients*. To do blending of images, we need to modify it a bit so that the coefficients represent how strong the effect of each image will be in the output. So we get the following equation:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>α</mi><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>1</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mi>s</mi><mi>r</mi><msub><mi>c</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\tdst(I) = \\alpha \\cdot src_{1}(I) + (1 - \\alpha) \\cdot src_{2}(I)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span></span></span></span></span>\n<p>With this function we get to blend the original and blurred images, but this is still not the effect we want since this will merge both images entirely and we want only certain subsections of it. To fix that, we need to vary the coefficients in such a way that in some sections the blurred image will have bigger effect and in others, the original image will have bigger effect. This is done by using the following function to characterize the coefficients:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>α</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>l</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>l</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>tanh</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>l</mi><mn>1</mn></mrow><mi>d</mi></mfrac><mo stretchy=\"false\">)</mo><mo>−</mo><mi>tanh</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>l</mi><mn>2</mn></mrow><mi>d</mi></mfrac><mo stretchy=\"false\">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">\t\\alpha(x, l1, l2, d) = \\frac{\\tanh(\\frac{x - l1}{d}) - \\tanh(\\frac{x - l2}{d})}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3011079999999997em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6151079999999998em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.7350000000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\">tanh</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801079999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mop\">tanh</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801079999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>Where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">l2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span></span></span></span> are the transition points in the image, where it changes between blurred to non-blurred, and the parameter <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> is how fast this transition happens. This might be hard to grasp from the mathematical definition alone, so let's look at the graph of this function for the parameters <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span></span></span></span> = -20, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">l2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span></span></span></span> = 30 and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> = 6.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAjEAAAIxAHydkeTAAAA10lEQVQoz5VS2xKEIAj1/7+2DPCCM6xQNtpauz2c4s5BcDlnYeYvZN7t6iciiSlKyslwm1PtTj8zcGahSIIBxYMXJDx1IJC7PPfUDWpyKUUCBdMLF9OVrRbvJ3lkqE4KJCGGXa4jp5SGGG02Zdi62v+Q1YERrZgxDAfDKnPhgeWQW+H0fTbcTqi++EUAwZgpAMCKNr3Bb17WbR1yXYzRuvXQ8RqMLaJoXG9vviG3xrjZQq5ob/hP7LnlfiFX/VrwGte2PZzN24Kv77BH2/KvuCnD6U2+YPgB3zysqmbYojIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Graph of the function that defines the coefficient\"\n        title=\"Graph of the function that defines the coefficient\"\n        src=\"/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/1d69c/geogebra-tanh.png\"\n        srcset=\"/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/4dcb9/geogebra-tanh.png 188w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/5ff7e/geogebra-tanh.png 375w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/1d69c/geogebra-tanh.png 750w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/78797/geogebra-tanh.png 1125w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/aa440/geogebra-tanh.png 1500w,\n/static/c7b9c9b3199c3d2f68ebd96bc30f1ccd/1307b/geogebra-tanh.png 3000w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>We can interpret this graph by thinking that in the places where its value is 0 the resulting image will be blurred, and where it's equal to one, the output image will not have any effect applied. In this way, only the regions near the top and bottom section of the picture will be blurred, which gives us an effect similar to the tilt-shift. We are also able to notice that the inflection points of the curves are given by the parameters <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">l2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">2</span></span></span></span>, we can use this fact to manipulate which section of the is going to be blurred.</p>\n<p>Now we have a way of simulating the tilt-shift: we blur the image and merge the blurred image with the original using a weighted adition, where the weights are given by the function we just defined above. Let's see how to do it using OpenCV.</p>\n<h2 id=\"putting-it-in-practice\" style=\"position:relative;\"><a href=\"#putting-it-in-practice\" aria-label=\"putting it in practice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting it in practice</h2>\n<p>The first thing we need to do is to translate the coefficient characterization function into a mask that we can apply to the image. The mask we want to create should look like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYCBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGzDCbxdGAP/8QAGhAAAQUBAAAAAAAAAAAAAAAABAACAxATAf/aAAgBAQABBQLAdFySsfuRXa//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIQQQMRMf/aAAgBAQAGPwKhqY+aLhI//8QAGxAAAQQDAAAAAAAAAAAAAAAAAQAQEfAxYXH/2gAIAQEAAT8huKmR0hXBsOG//9oADAMBAAIAAwAAABAjz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB4QAAIABgMAAAAAAAAAAAAAAAABESFhcbHwEEGh/9oACAEBAAE/EK+txJjPE5k4tYKetjo8fHH/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Mask created using the characterization function\"\n        title=\"Mask created using the characterization function\"\n        src=\"/static/ddaada636d412cf79a3834fe066f2745/b4294/example-mask.jpg\"\n        srcset=\"/static/ddaada636d412cf79a3834fe066f2745/bc01b/example-mask.jpg 188w,\n/static/ddaada636d412cf79a3834fe066f2745/bf173/example-mask.jpg 375w,\n/static/ddaada636d412cf79a3834fe066f2745/b4294/example-mask.jpg 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The dark part are the sections of the image in which it will have a lower effect in the result (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> = 0), the white part is where the original image will have greater effect (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> = 1). We need two masks because one will be applied to the original image and the other one to the blurred image.</p>\n<p>To create this mask, we're going to first create an array with size being equal to the image height, filled with discrete samples of the function. This is done by defining the following C++ function:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdio></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cmath></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;opencv2/opencv.hpp></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;lyra/lyra.hpp></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\"><span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>exp<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">,</span> exp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token comment\">// ------ Blending mask generation -------</span>\n\n<span class=\"token comment\">// Generates data for a single row of a blending mask given by the function</span>\n<span class=\"token comment\">//</span>\n<span class=\"token comment\">// ( tanh((x - lb) / decay) - tanh((x - hb) / decay) ) / 2</span>\n<span class=\"token comment\">//</span>\n<span class=\"token comment\">// This function will be evaluated between [low_bound] and [high_bound] </span>\n<span class=\"token comment\">// and will generate a vector with exactly [size] values.</span>\nstd<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> <span class=\"token function\">blend</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> min_range<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> max_range<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> low_bound<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> high_bound<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> decay<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>min_range <span class=\"token operator\">&lt;</span> max_range<span class=\"token punctuation\">,</span> <span class=\"token string\">\"blend range is defined incorrectly. min_range >= max_range\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>low_bound <span class=\"token operator\">&lt;=</span> high_bound<span class=\"token punctuation\">,</span> <span class=\"token string\">\"boundary range is defined incorrectly. low_bound > high_bound\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>decay <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"decay coefficient is equal to zero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">float</span><span class=\"token operator\">></span> lu_table<span class=\"token punctuation\">;</span>\n    lu_table<span class=\"token punctuation\">.</span><span class=\"token function\">reserve</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// Preallocate memory since we already know the final size</span>\n\n    <span class=\"token keyword\">float</span> step <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>max_range <span class=\"token operator\">-</span> min_range<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> size<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> size<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">float</span> x <span class=\"token operator\">=</span> min_range <span class=\"token operator\">+</span> i <span class=\"token operator\">*</span> step<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">float</span> result <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span><span class=\"token function\">tanh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-</span> low_bound<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> decay<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> std<span class=\"token operator\">::</span><span class=\"token function\">tanh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-</span> high_bound<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> decay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        lu_table<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> lu_table<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>The function does the evaluation of the coefficient characterization function for the range between [<em>min_range</em>, <em>max_range</em>], sampling it in equal intervals with period defined by <em>step</em>. The resulting values are stored into an array and returned to the caller. The assertm function is used to make some simple assertions about its invariants.</p>\n<p>After running this function, we get an array with the our desired values, but this is still not the mask we want. To complete the process we need to transpose the array and copy it across across the columns until we have the same width of the image. To do this, we need to define another function:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">cv<span class=\"token operator\">::</span>Mat <span class=\"token function\">smooth_blend_mask</span><span class=\"token punctuation\">(</span>\n    cv<span class=\"token operator\">::</span>Size size<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">int</span> min_range<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">int</span> max_range<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">int</span> low_bound<span class=\"token punctuation\">,</span> \n    <span class=\"token keyword\">int</span> high_bound<span class=\"token punctuation\">,</span> \n    <span class=\"token keyword\">int</span> decay\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cv<span class=\"token operator\">::</span>Mat <span class=\"token function\">mask</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> blend_values <span class=\"token operator\">=</span> <span class=\"token function\">blend</span><span class=\"token punctuation\">(</span>min_range<span class=\"token punctuation\">,</span> max_range<span class=\"token punctuation\">,</span> low_bound<span class=\"token punctuation\">,</span> high_bound<span class=\"token punctuation\">,</span> decay<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span>Mat <span class=\"token function\">blend_mask_row</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span> CV_32FC1<span class=\"token punctuation\">,</span> blend_values<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Repeat the row with blending values to generate an image mask.</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> size<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        blend_mask_row<span class=\"token punctuation\">.</span><span class=\"token function\">copyTo</span><span class=\"token punctuation\">(</span>mask<span class=\"token punctuation\">.</span><span class=\"token function\">row</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// The function values were laid out horizontally</span>\n    <span class=\"token comment\">// but we want the mask to be vertical rather than horizontal</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">transpose</span><span class=\"token punctuation\">(</span>mask<span class=\"token punctuation\">,</span> mask<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> mask<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>In this snippet, I copied the array of data horizontally and transposed the resulting mask, which gives the same result as transposing it first, then copying across the columns.</p>\n<p>With the mask ready, we are now able to apply it to the image and see the resulting tilt-shift. But before doing that, let's use the GUI tools from OpenCV so that we can manipulate the effect and have a better understanding of it.</p>\n<p>We're going to define three sliders:</p>\n<ul>\n<li><strong>center</strong> - The middle point of where the mask will be applied in the image</li>\n<li><strong>decay</strong> - How fast the transition between blurred to non-blurred happens</li>\n<li><strong>range</strong> - How wide the non-blurred section of the image will be.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// ------  UI slider management -------</span>\n\n<span class=\"token comment\">// Middle point of the mask</span>\n<span class=\"token keyword\">int</span> center <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> center_slider <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> center_slider_max <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// How fast the transition between blurred to not-blurred</span>\n<span class=\"token comment\">// happens</span>\n<span class=\"token keyword\">int</span> decay <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> decay_slider <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> decay_slider_max <span class=\"token operator\">=</span> <span class=\"token number\">39</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Defines the non-blurred region in the image</span>\n<span class=\"token keyword\">int</span> range <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> range_slider <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> range_slider_max <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\ncv<span class=\"token operator\">::</span>Mat image<span class=\"token punctuation\">,</span> blur_mask<span class=\"token punctuation\">,</span> blurred_image<span class=\"token punctuation\">;</span>\ncv<span class=\"token operator\">::</span>Mat weighted_blur<span class=\"token punctuation\">,</span> weighted_image<span class=\"token punctuation\">,</span> blended<span class=\"token punctuation\">;</span>\ncv<span class=\"token operator\">::</span>Mat imageTop<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">char</span> trackbar_name<span class=\"token punctuation\">[</span><span class=\"token number\">50</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">auto</span> min_range <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token operator\">-</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> max_range <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token operator\">-</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> low_bound <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>range <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> hi_bound <span class=\"token operator\">=</span> <span class=\"token operator\">+</span>range <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    blur_mask <span class=\"token operator\">=</span> <span class=\"token function\">smooth_blend_mask</span><span class=\"token punctuation\">(</span>\n        image<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n        min_range<span class=\"token punctuation\">,</span>\n        max_range<span class=\"token punctuation\">,</span>\n        low_bound<span class=\"token punctuation\">,</span> \n        hi_bound<span class=\"token punctuation\">,</span> \n        decay\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Mat bgr_mask<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Makes the single channel mask into a three channel image </span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">cvtColor</span><span class=\"token punctuation\">(</span>blur_mask<span class=\"token punctuation\">,</span> bgr_mask<span class=\"token punctuation\">,</span> cv<span class=\"token operator\">::</span>COLOR_GRAY2BGR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">auto</span> inverse_mask <span class=\"token operator\">=</span> <span class=\"token function\">CV_RGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> bgr_mask<span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span><span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>bgr_mask<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">,</span> weighted_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>inverse_mask<span class=\"token punctuation\">,</span> blurred_image<span class=\"token punctuation\">,</span> weighted_blur<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>weighted_image<span class=\"token punctuation\">,</span> weighted_blur<span class=\"token punctuation\">,</span> blended<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    blended<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>blended<span class=\"token punctuation\">,</span> CV_8UC3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">imshow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span> blended<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">on_trackbar_center_changed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    center <span class=\"token operator\">=</span> center_slider<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">on_trackbar_decay_changed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    decay <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> decay_slider<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">on_trackbar_range_changed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    range <span class=\"token operator\">=</span> range_slider<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">do_blending</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>The most interesting part of the snipper above is the <em>do_blending()</em> function, which starts with the definition of the ranges in which the coefficient function will be evaluated and the center variable, which is not the center of the mask, nor the center of the image, but rather a mapping between the image and the mask: When <em>center = 0</em> the center of the function is at the start of the image, when <em>center = 50</em> the center of the function is at the middle of the image and when <em>center = 100</em>, the center of the function is at the end of the image.</p>\n<p>This is easier to see with an image depiction:</p>\n<p>When <em>center = 0</em> :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3klEQVQoz4VSi3KEMAjM//9r61UbHoFkC6l63o3TMrOT5eFCMAW7jTHOs1mHeZ++u4OIJu99QM1fat+t3Ak+vgWfm8BDQNRQiREUVQwfqwT/Q/AafOExmbcGienqtqEHT9zWBj/8cjjXYDebmDyEReTk2WRcRN5RcGOu+hTPvYV/mKX4zVXPKy/LghZdDygzqFZwfGgxZU5HVCdv1lAjl2s46s1t/rTUyZoyCzNxOSlEZRfMGJNAWKCiWNctcvoEy4msLfjHejwfehC06r4OB38xmvzuuHE0jBeRsVzuD+PTd3ioZqEoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Coefficient function when the center is equal to 0\"\n        title=\"Coefficient function when the center is equal to 0\"\n        src=\"/static/ed0db375b09dcb2d7981c89bb05ad4d9/f2793/function-center-0.png\"\n        srcset=\"/static/ed0db375b09dcb2d7981c89bb05ad4d9/4dcb9/function-center-0.png 188w,\n/static/ed0db375b09dcb2d7981c89bb05ad4d9/5ff7e/function-center-0.png 375w,\n/static/ed0db375b09dcb2d7981c89bb05ad4d9/f2793/function-center-0.png 743w\"\n        sizes=\"(max-width: 743px) 100vw, 743px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>When <em>center = 50</em> :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQoz31SgRKDIAj1//91q1UqiPoGXLXavHH3zgfRA8SA3Xrv51mkQWpzv9aKlJLz1jpY6i3328JIcN4Iz5VQVYBYEFOGUkQSPBZS/kfwGrxx7ayWAtLu4rqiKTcMc5Uffjica7CJOJyrMBGd3Ir0i8g3AgZWmT/irYHVP0xMfDDqOfI0TSha9QDn7EuwrkS7ZCbEGJ0XKc7tGooWsXyLW8x0jAdP3D+4KBesy6ZJCUx8gvbzNS8qSJ7386/iNrI/mVyQ5qT31dzPulXetJss7pNu38CRhyO/Ac07d2nf/UjrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Coefficient function when the center is equal to 50\"\n        title=\"Coefficient function when the center is equal to 50\"\n        src=\"/static/49b1700e954b4affda704d89b6d827e0/f2793/function-center-50.png\"\n        srcset=\"/static/49b1700e954b4affda704d89b6d827e0/4dcb9/function-center-50.png 188w,\n/static/49b1700e954b4affda704d89b6d827e0/5ff7e/function-center-50.png 375w,\n/static/49b1700e954b4affda704d89b6d827e0/f2793/function-center-50.png 743w\"\n        sizes=\"(max-width: 743px) 100vw, 743px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>When <em>center = 100</em> :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4ElEQVQoz31Ri3IDIQj0//+1vWtOBXxtF1PTS+YSZhh2URaUgD8bYzxiqR219clba8g5T9z7gNX2dPfVwpXgHhXfh6JRQK0iZQEhklZ83ZT4g+A5+YQ5WSsFyunScaATu1/eJV48LHJO9lqnT0xhVX1gbzJOIq8ecGHN7F+8dxj5smrqanhnYd93LqGglLubCHJKc6rKKV0skTv28xQjlLww79zzfr5t28RBxaCiFLDpxbwoUTTDPJd1xlUcKbiaryYruoe8szDdn1SkQG4Ci8b/GqjcqnDb8iMY/f0zz/YLvIB3bQVnQdcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Coefficient function when the center is equal to 100\"\n        title=\"Coefficient function when the center is equal to 100\"\n        src=\"/static/aca6b66ba64fcb463af9aa55d4e5bd65/f2793/function-center-100.png\"\n        srcset=\"/static/aca6b66ba64fcb463af9aa55d4e5bd65/4dcb9/function-center-100.png 188w,\n/static/aca6b66ba64fcb463af9aa55d4e5bd65/5ff7e/function-center-100.png 375w,\n/static/aca6b66ba64fcb463af9aa55d4e5bd65/f2793/function-center-100.png 743w\"\n        sizes=\"(max-width: 743px) 100vw, 743px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>You can think about the vertical axis of the image being the purple line at the pictures above.</p>\n<p>Finally, we can join everything together and see the results.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdio></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cmath></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;opencv2/opencv.hpp></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;lyra/lyra.hpp></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\"><span class=\"token function\">assertm</span><span class=\"token punctuation\">(</span>exp<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">,</span> exp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>string image_path<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> height<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nConfig <span class=\"token function\">parse_cli</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* parse cli arguments */</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* blending function */</span>\n\n<span class=\"token comment\">/* blending mask function */</span>\n\n<span class=\"token comment\">/* ui trackbars and listeners */</span>\n\n<span class=\"token keyword\">const</span> cv<span class=\"token operator\">::</span>Matx33f blur_filter <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.</span><span class=\"token operator\">/</span><span class=\"token number\">9</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">auto</span> config <span class=\"token operator\">=</span> <span class=\"token function\">parse_cli</span><span class=\"token punctuation\">(</span>argc<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    image <span class=\"token operator\">=</span> cv<span class=\"token operator\">::</span><span class=\"token function\">imread</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span>Size image_size <span class=\"token punctuation\">{</span> config<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>height <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">resize</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">,</span> image_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">convertTo</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> CV_32FC3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">copyTo</span><span class=\"token punctuation\">(</span>blurred_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// We apply blurring multiple times so the</span>\n    <span class=\"token comment\">// effect is more visible</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        cv<span class=\"token operator\">::</span><span class=\"token function\">filter2D</span><span class=\"token punctuation\">(</span>\n            blurred_image<span class=\"token punctuation\">,</span> \n            blurred_image<span class=\"token punctuation\">,</span> \n            blurred_image<span class=\"token punctuation\">.</span><span class=\"token function\">depth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n            blur_filter\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Creating the trackbars </span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">namedWindow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Center x %d\"</span><span class=\"token punctuation\">,</span> center_slider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">createTrackbar</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token operator\">&amp;</span>center_slider<span class=\"token punctuation\">,</span>\n            center_slider_max<span class=\"token punctuation\">,</span>\n            on_trackbar_center_changed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">on_trackbar_center_changed</span><span class=\"token punctuation\">(</span>center_slider<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token operator\">::</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Decay x %d\"</span><span class=\"token punctuation\">,</span>  decay_slider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">createTrackbar</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token operator\">&amp;</span>decay_slider<span class=\"token punctuation\">,</span>\n            decay_slider_max<span class=\"token punctuation\">,</span>\n            on_trackbar_decay_changed <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">on_trackbar_decay_changed</span><span class=\"token punctuation\">(</span>decay_slider<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token operator\">::</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Range x %d\"</span><span class=\"token punctuation\">,</span>  range_slider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cv<span class=\"token operator\">::</span><span class=\"token function\">createTrackbar</span><span class=\"token punctuation\">(</span>trackbar_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"addweighted\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token operator\">&amp;</span>range_slider<span class=\"token punctuation\">,</span>\n            range_slider_max<span class=\"token punctuation\">,</span>\n            on_trackbar_range_changed <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">on_trackbar_range_changed</span><span class=\"token punctuation\">(</span>range_slider<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token operator\">::</span><span class=\"token function\">waitKey</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p><em>To parse the command line arguments I've used the <a href=\"https://github.com/bfgroup/Lyra\">lyra</a> library, but you can use whatever library you prefer.</em></p>\n<p>This is the result we get when running the binary on <a href=\"https://www.flickr.com/photos/romainguy/50386634128/in/dateposted-public/\">this image</a> with the parameters <em>center = 58</em>, <em>decay = 10</em> and <em>range = 45</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADkUlEQVQozyXS209aBwDH8YORJjNZsvRlw2bKuCkIHA4cDnDwMC5H7ncBQSgWcNwpoMAQKlQtdmqt7VaXmXVr67J6w6m0OkNbNJot62Kyh/0Ffdj7tmTvo9vv/ZPfyxcgEAgAAHxA6tZpLUw2HxTJeimMHjKNyYVFqMzpcgfDCbPNSaYyeLB4gMsfYLIYdHpbEYnENgSIxEs4rmPzYBaEkCl9LBAe4CEKXJstlKu1O0+2GrXFZQgW9bO5ICSABDACw1dIJOD/sVgcoQij9LEpNOZbyRVQ6f08AfLg4frjpzufLd3Vm2x8BJVicp/XjaJSHsgRCaDOzk6gq6tLJJJR25LO7CVTqYwBLoRI5TgoEHn8425/lC/WiOVWVDU8kS/ZRwJiTKvEdVKJpJv0PvBhDxnkIaTunl4yTak2lKozZptj1B8Sy80GxzimC7WV1JSdrHyenLonNSRxa0JhCCjUwzAPBJhMDo3OpFD72n9Ot3dhcVFvHkGHRg0jmUB6gYXnxfb5iVsbudqWyruiv3ZP472t984YRwsq5RDA5UIfUWggX2i02FB0UIiqJLgXdxay02tix0Jsbsec2XDm6vbMtjn5vSWxbop8aw5/pRtbcnrG2xhk9DEggQBFJXKlVqb1SYy5VPnrsdy6IbEZmG/y43uKZAMO/EDz7FL9DTRSt6Y39eFvotcrgADisdksjVqlUCpDkUxtce3ulzuV5QM8sukqHvPDz6D4kTB6NJj76XLuDWP+D3asqYjtqD5Zv56vAZgY5rD7BXwQhDHcGreFliKlp/6pA1v+2F58ZSmfDBVa0S9+++vvf6ov/rx6/wKL1NvnhtRWLJEDBhFICHFRKRpOFrTuG/rgqia2Ycw+Hy6+dE2faosnwtQrZfXCXDl/sPu7aaqJRPY16X13bitw1QPwWAyVDFUOGexjBaGxbIo9sWT3ncVje+kl/mkruvKr6caZKNNK3f/FNXvKCTWUmQYWrU/OPJIKOcDl9951WfR8sZaK+IzXluWBx5r0wcfZo+PXb6y3fgbjTffsuWfubHL1NRg9HEwfqiefWzLb1ekKsbPjbZ4qTGhzBjFbURdYBT2PrKWjK4G95NqFbe5cXz4dmT133DwzlFrqQlOd/1ER37298h0m4v1XNoHQ9c6laNBn8FaUwYeyyKYkWgeje0jq0Drdctw8tVZO7NUTW6Vlr7zQTTybWtxOjvvarqOD8C/AgTicTnG0TwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Image of a watch with tilt shift applied\"\n        title=\"Image of a watch with tilt shift applied\"\n        src=\"/static/b691a0940798738787decf380159c69e/6af66/watch-tilt-shift.png\"\n        srcset=\"/static/b691a0940798738787decf380159c69e/4dcb9/watch-tilt-shift.png 188w,\n/static/b691a0940798738787decf380159c69e/5ff7e/watch-tilt-shift.png 375w,\n/static/b691a0940798738787decf380159c69e/6af66/watch-tilt-shift.png 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>We can see that the effect on the image is very similar to the tilt-shift made by professional camera lenses, where the center is focused and the borders are blurred.</p>"}},"pageContext":{"slug":"opencv-tilt-shift","lang":"en","language":"en","i18n":{"language":"en","languages":["en","pt"],"defaultLanguage":"en","routed":false,"resources":{"en":{"about":{"About me":"About me","my-description":"I'm a student of computer engineering at Universidade Federal do Rio Grande do Norte. I'm interested primarily in topics about Android Development, but I also have a hobbyist interest in Machine Learning and Operating Systems.","need-developer":"Need a developer?","contact-me":"Contact me."},"bloglist":{"Blog":"Blog","blog-description":"Small posts about computer science stuff that I found useful."},"contact":{"contact-info":"Contact Information"},"footer":{"gatsby-credit":"Created by {{creator}} with","fireplace-icon":"Fireplace Icon","by":"by"},"header":{"Edu's coding fireplace":"Edu's coding fireplace","Home":"Home","Blog":"Blog","About":"About","Contact":"Contact"},"home":{"hello":"Hello.","i-am":"I'm","my-place":"and this is where I sit down and share my thoughts about coding topics.","my-goal":"Hopefully I'll be able to share useful information to the world, the same way it did for me."},"projects":{"diversify":{"header":"Diversify - A playlist generator for Spotify (WIP)","content":"A playlist generator for Spotify that aims to mutually satisfy, as best as it can, the musical taste of a group of users. It uses a clustering algorithm to detect patterns in each users taste and decide which music is closest to the users collective tastes.\n\n An website made using Django and React is currently being made.","url":"https://github.com/edujtm/diversify"},"tuyo":{"header":"Tuyo - Playlist manager for YouTube (WIP)","content":"A native Android app made with Kotlin that allows for bulk management of YouTube playlists. It follows the Android Architecture guide using architecture components to deal with lifecycle management, Dagger for dependency injection and Espresso and JUnit for functional and unit testing, respectively. \n\n With this project, I've learned a bit more about how to manage lifecycles and avoid memory leaks and also how to cache data from a third party API.","url":"https://github.com/edujtm/tuyo"},"personal-website":{"header":"Personal website - Gatsby.js","content":"This website was made using Gatsby.js and GraphQL to obtain a responsive design and to produce free content for people interested in programming topcs. The website uses i18next for internationalization of its entire content and is currently being migrated to TypeScript.","url":"https://github.com/edujtm/edujtm.github.io"}}}},"originalPath":"/blog/opencv-tilt-shift","path":"/blog/opencv-tilt-shift"}}},"staticQueryHashes":["3159585216","3159585216","440568431"]}