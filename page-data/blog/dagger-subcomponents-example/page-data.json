{"componentChunkName":"component---src-templates-blog-js","path":"/blog/dagger-subcomponents-example","result":{"data":{"markdownRemark":{"id":"2a2fabc4-2e3f-5f3d-9703-57e7c580ed87","frontmatter":{"title":"Understand Dagger 2: An Error-Driven Way","date":"14/07/2020"},"html":"<p><em>Disclaimer: I'm not an experienced Dagger developer, I've made this post to gather my thoughts because I had a moment of clarity. In case I ever forget what I learned, I can come back here and relearn it.</em></p>\n<p><em>Why make it public? From the perspective of a beginner, I think I have a good example that might help experienced developers explain dagger to other people like me.</em></p>\n<h3 id=\"pre-requisites\" style=\"position:relative;\"><a href=\"#pre-requisites\" aria-label=\"pre requisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pre-Requisites</h3>\n<ul>\n<li>This post assumes you already understand Dagger Components and how to do Bindings to the Dagger object graph (i.e. using <code class=\"language-text\">@Inject</code>, <code class=\"language-text\">@Provides</code> and <code class=\"language-text\">@Binds</code>).</li>\n<li>It also assumes that you know how a basic Android Application works</li>\n</ul>\n<h2 id=\"the-subcomponent-hill\" style=\"position:relative;\"><a href=\"#the-subcomponent-hill\" aria-label=\"the subcomponent hill permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The subcomponent hill</h2>\n<p>After learning how to provide dependencies using a single <code class=\"language-text\">@Component</code> that encompasses the whole application lifetime, it's tempting to use <code class=\"language-text\">@Singleton</code> and <code class=\"language-text\">Provider&lt;T&gt;</code> to resolve all of your dependencies, since it makes so simple to <code class=\"language-text\">@Inject</code> everything you need. </p>\n<h2 id=\"the-application\" style=\"position:relative;\"><a href=\"#the-application\" aria-label=\"the application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The application</h2>\n<p>The application we'll build will query the <a href=\"https://developers.google.com/youtube/v3\">Youtube Data API</a> for the favorites videos of a user after making a simple authentication using the <a href=\"https://developers.google.com/identity/sign-in/android\">Google SignIn library</a>, but previous knowledge of these libraries is not required. </p>\n<p>It'll have two activities, one for login and another with the list of favorite videos' titles, with a <code class=\"language-text\">ViewModel</code> for the latter. The login activity will need a <code class=\"language-text\">AuthManager</code> interface that manages the sign in with Google and the <code class=\"language-text\">PlaylistViewModel</code> for the list will use a <code class=\"language-text\">YouTube</code> wrapper class provided by the <a href=\"https://developers.google.com/api-client-library/java/\">Youtube API client</a>.</p>\n<p>Here is a visualization of this structure:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2klEQVQoz2VSTU8UQRCdH8YFiIYjBxLEmxA1fnJZs3AgXv0xJHvZC2jiamA3KEiWNYgCMRpjNmZnYKdnpqe7p/tZXTszrlpJpapnql69+giyLIOIY2RSwiqFsNVCuL2NvN2G6nbhMBFrLT6fX6I/OMXXbz/wK7xCYQukWYo0TaG15riAg4uCHy5JkC8twc3OwszMQK6v14AFxewdHGPn9T7ekj0anJXfHZIkRZ7nE0DnHAcbb8djpGtr+L71HMMnT6E2N5FR4Gg04g56h328etND9/AE/dMv+Fc8VlB6zMSJGPnqKoaNZ4ju3YduNqGpmKJR5LnCu+OP6Oy/R+9ogJNPFzVIpTXD6mGp5evlZaQ3b0DMzSFuNOrqvouXnT202jvY7XRx8GHwHyAznAYU1PLjxUXcXVjAnfl5vKAZVhLT4h48fIRbK7dJV9Dc2PgLsBJq2XHL1c+IEodhiJ80t2tiPP3PX0QcC5ppyP707KydaKCNdwDD1lYhpf5J4JGUtW2pfgw+x2P4Q/EbD2KRcTWRSIzHtBQlIWg5UmaUVJS4joGUMkiEoDMR5Bd8f5K2r7VFFEVkFYI0U7xFmRtmUlhDlQwfLQOiAnTExFInBTNT2tYdeECtDbP9DZft5IcTsqLvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Application architecture\"\n        title=\"Application architecture\"\n        src=\"/static/4bc342320573452cd9841dee10be0ca6/1d69c/app-architecture-intro.png\"\n        srcset=\"/static/4bc342320573452cd9841dee10be0ca6/4dcb9/app-architecture-intro.png 188w,\n/static/4bc342320573452cd9841dee10be0ca6/5ff7e/app-architecture-intro.png 375w,\n/static/4bc342320573452cd9841dee10be0ca6/1d69c/app-architecture-intro.png 750w,\n/static/4bc342320573452cd9841dee10be0ca6/78797/app-architecture-intro.png 1125w,\n/static/4bc342320573452cd9841dee10be0ca6/aa440/app-architecture-intro.png 1500w,\n/static/4bc342320573452cd9841dee10be0ca6/9e50e/app-architecture-intro.png 4560w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>This is a very basic application but due to the way the Youtube API Client wrapper is designed, it presents a perfect opportunity to show how <code class=\"language-text\">@Subcomponent</code> work.</p>\n<h2 id=\"project-setup\" style=\"position:relative;\"><a href=\"#project-setup\" aria-label=\"project setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Project Setup</h2>\n<p>There is a small annoying setup on the <a href=\"https://console.developers.google.com/\">google developers console</a> necessary to use those libraries. I'll give the steps if you wish to follow along, but you can still understand the article without doing it. If you don't want to follow along, you can jump to the <a href=\"#the-login-screen\">next section</a>.</p>\n<p>For the sake of brevity, I've made a github repository with the screens and libraries already setup. The setup necessary is only for accessing the Google APIs.  </p>\n<ol>\n<li>\n<p>Setup your google developers console to activate the Youtube Data API</p>\n<ul>\n<li>Open the <a href=\"https://console.developers.google.com/\">console</a></li>\n<li>Go to the <em>Library tab</em> on the side navigation panel</li>\n<li>Search for <em>Youtube Data</em>, click on the option that appears.</li>\n<li>Click the <em>Enable</em> button</li>\n<li>Go to the <em>credentials tab</em> on the side navigation panel</li>\n<li>Click on <em>Create Credentials</em>, choose the Android <em>Application Type</em> and fill the fields</li>\n<li>on the SHA-1 field you need to run the following command on the terminal</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=edujtm data-host=localhost></span></span>keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android</code></pre></div>\n<br />\n<h2 id=\"the-login-screen\" style=\"position:relative;\"><a href=\"#the-login-screen\" aria-label=\"the login screen permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Login screen</h2>\n<p>With everything setup, we can begin implementing the login screen which will need an <code class=\"language-text\">AuthManager</code> to manage the user authentication. The login button sends an intent.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> LoginActivity <span class=\"token operator\">:</span> <span class=\"token function\">AppCompatActivity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">lateinit</span> <span class=\"token keyword\">var</span> authManager<span class=\"token operator\">:</span> AuthManager\n\n\t<span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token operator\">:</span> Bundle<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_login<span class=\"token punctuation\">)</span>\n\n\t\tlogin_btn<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// The Sign-In library uses an intent for authentication</span>\n\t\t\t<span class=\"token keyword\">val</span> intent <span class=\"token operator\">=</span> authManager<span class=\"token punctuation\">.</span><span class=\"token function\">getSignInIntent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">startActivityForResult</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">,</span> REQUEST_SIGN_IN<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onActivityResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> REQUEST_SIGN_IN <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>We need to get an <code class=\"language-text\">AuthManager</code> instance, since a <code class=\"language-text\">@Component</code> is our window to the Dagger object graph (which we'll still build), we need to start there. So let's create a <code class=\"language-text\">AppComponent</code> that will start our dependency graph.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Component</span>\n<span class=\"token keyword\">interface</span> AppComponent <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">val</span> authManager<span class=\"token operator\">:</span> AuthManager\t\n<span class=\"token punctuation\">}</span></code></pre></div>"}},"pageContext":{"slug":"dagger-subcomponents-example"}}}