<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.c091e7c20c04ad10f386.css">code[class*=language-],pre[class*=language-]{color:#a9b7c6;font-family:Consolas,Monaco,Andale Mono,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{color:inherit;background:rgba(33,66,131,.85)}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.prolog{color:grey}.token.atrule,.token.boolean,.token.delimiter,.token.important,.token.keyword,.token.selector{color:#cc7832}.token.attr-name,.token.operator,.token.punctuation{color:#a9b7c6}.token.builtin,.token.doctype,.token.tag,.token.tag .punctuation{color:#e8bf6a}.token.entity,.token.number,.token.symbol{color:#6897bb}.token.constant,.token.property,.token.variable{color:#9876aa}.token.char,.token.string{color:#6a8759}.token.attr-value,.token.attr-value .punctuation{color:#a5c261}.token.attr-value .punctuation:first-child{color:#a9b7c6}.token.url{color:#287bde;text-decoration:underline}.token.function{color:#ffc66d}.token.regex{background:#364135}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.inserted{background:#294436}.token.deleted{background:#484a4a}code.language-css .token.property,code.language-css .token.property+.token.punctuation{color:#a9b7c6}code.language-css .token.id,code.language-css .token.selector>.token.attribute,code.language-css .token.selector>.token.class,code.language-css .token.selector>.token.pseudo-class,code.language-css .token.selector>.token.pseudo-element{color:#ffc66d}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.NavigationBar-module--nav-list--VWmL8{display:flex;list-style-type:none;margin:0}.NavigationBar-module--nav-item--1bjuq{color:#999;font-size:.9rem;margin-right:1.3rem;padding:0 2px;text-decoration:none;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out;position:relative}.NavigationBar-module--nav-item--1bjuq:after,.NavigationBar-module--nav-item--1bjuq:before{content:"";position:absolute;bottom:-7px;width:0;height:2px;margin:2px 0 0;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out;-webkit-transition-duration:.25s;transition-duration:.25s;opacity:0;background-color:#fb8177}.NavigationBar-module--nav-item--1bjuq:before{left:50%}.NavigationBar-module--nav-item--1bjuq:after{right:50%}.NavigationBar-module--nav-item--1bjuq:hover{cursor:pointer;color:#666}.NavigationBar-module--nav-item--1bjuq:hover:after,.NavigationBar-module--nav-item--1bjuq:hover:before{opacity:1;width:50%}.NavigationBar-module--active-nav-item--3YWLJ{color:#333}.Header-module--header--2E8ew{padding:1rem 0 3rem}.Header-module--title--1WXgF{color:#000;font-size:3rem;text-decoration:none}.Footer-module--footer--3yGWB{margin-top:3rem}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{color:#fb8177;text-decoration:none;background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{color:#cb7a64;outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em,georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:sans-serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,p{padding:0;margin:0 0 1.45rem}p{font-family:Zilla Slab,Merriweather,Oswald,sans-serif;font-size:1.2em}figure{padding:0}figure,pre{margin:0 0 1.45rem}pre{font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}.Layout-module--container--2DmHh{margin:0 auto;max-width:750px;padding:1rem;display:flex;flex-direction:column;min-height:100vh}.Layout-module--content--3KiRz{flex:1 1}.RoundImage-module--round-image--3WuE7{border-radius:50%}.About-module--profile-container--312zr{display:flex;flex-direction:row;align-items:stretch;justify-content:center}.About-module--profile-picture--sN322{margin:auto 30px auto auto;flex:2 1}.About-module--profile-description--20AZi{flex:8 1}@-webkit-keyframes blog-module--shadow-drop-2-center--UKVRN{0%{-webkit-transform:translateZ(0);transform:translateZ(0);box-shadow:0 0 0 0 transparent}to{-webkit-transform:translateZ(50px);transform:translateZ(50px);box-shadow:0 0 20px 0 rgba(0,0,0,.35)}}@keyframes blog-module--shadow-drop-2-center--UKVRN{0%{-webkit-transform:translateZ(0);transform:translateZ(0);box-shadow:0 0 0 0 transparent}to{-webkit-transform:translateZ(50px);transform:translateZ(50px);box-shadow:0 0 20px 0 rgba(0,0,0,.35)}}.blog-module--posts--a25pe{list-style-type:none;margin:0}.blog-module--post--1jMia{margin:1rem 0}.blog-module--post--1jMia a{color:#000;display:block;padding:1.5rem 1.2rem;text-decoration:none;border-radius:12px;border:1px solid #fb8177}.blog-module--post--1jMia a:hover{-webkit-animation:blog-module--shadow-drop-2-center--UKVRN .4s cubic-bezier(.25,.46,.45,.94) both;animation:blog-module--shadow-drop-2-center--UKVRN .4s cubic-bezier(.25,.46,.45,.94) both}.blog-module--post--1jMia h2{margin-bottom:0}.blog-module--post--1jMia p{color:#777;font-size:.8rem;font-style:italic}</style><meta name="generator" content="Gatsby 2.19.7"/><title data-react-helmet="true">Manipulating images using OpenCV region of interest | Edu&#x27;s coding fireplace</title><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/webpack-runtime-11a928335baca9ccf693.js"/><link as="script" rel="preload" href="/app-d542304e5dd43fcc15d7.js"/><link as="script" rel="preload" href="/styles-4f9fb81ff0cc2dbc3273.js"/><link as="script" rel="preload" href="/commons-4c1b28b38614419ffced.js"/><link as="script" rel="preload" href="/component---src-templates-blog-js-d9b1752aa94e680343c3.js"/><link as="fetch" rel="preload" href="/page-data/blog/opencv-image-manipulation/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Layout-module--container--2DmHh"><div class="Layout-module--content--3KiRz"><header class="Header-module--header--2E8ew"><h1><a class="Header-module--title--1WXgF" href="/">Edu&#x27;s coding fireplace</a></h1><nav><ul class="NavigationBar-module--nav-list--VWmL8"><li><a class="NavigationBar-module--nav-item--1bjuq" href="/">Home</a></li><li><a class="NavigationBar-module--nav-item--1bjuq" href="/blog">Blog</a></li><li><a class="NavigationBar-module--nav-item--1bjuq" href="/about">About</a></li><li><a class="NavigationBar-module--nav-item--1bjuq" href="/contact">Contact</a></li></ul></nav></header><h1>Manipulating images using OpenCV region of interest</h1><p>04/10/2020</p><div><h2 id="image-manipulation" style="position:relative;"><a href="#image-manipulation" aria-label="image manipulation permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Image manipulation</h2>
<p>One of the most basic tasks when manipulating images is to apply a certain operation to a subsection of an image. We might want to enhance a certain portion of an image so that it becomes hightlighted or apply an special effect to an specified region. The OpenCV library offers several ways of doing these operations, which I'm hoping to show with simple examples in this article.</p>
<p>To show these different kinds of operations, we'll make a simple program that changes a subsection of an image to it's negative counterpart. Wikipedia defines a <a href="https://en.wikipedia.org/wiki/Negative_(photography)">negative image</a> as such:</p>
<blockquote>
<p>In photography, a negative is an image, usually on a strip or sheet of transparent plastic film, in which the lightest areas of the photographed subject appear darkest and the darkest areas appear lightest.</p>
</blockquote>
<p>So the program needs to take an image and change it's light section to dark and vice-versa. We need to ask the user to specify two points in the image that defines the top left and lower right corners of a rectangular section in which we'll apply our operation. To make our life easier, we'll resize the image so it's 200 x 200 pixels and check for out of bounds access.</p>
<h3 id="the-naive-way" style="position:relative;"><a href="#the-naive-way" aria-label="the naive way permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The naive way</h3>
<p>If you think about an image as a 2D array, the first way that comes to mind of manipulating the image is to use two <em>for</em> loops and change the pixels one by one. OpenCV offers two functions to access the pixels in an image:</p>
<ul>
<li><a href="https://docs.opencv.org/4.4.0/d3/d63/classcv_1_1Mat.html#ac40425b84f60b39fd35e03814122661f">Mat::at(x, y)</a> - Returns a reference to the value at row x and column y.</li>
<li><a href="https://docs.opencv.org/4.4.0/d3/d63/classcv_1_1Mat.html#abda2b96aa438a808b43425040a7da81a">Mat::ptr(x, y)</a> - Returns a pointer to the value at row x and column y.</li>
</ul>
<p>These functions have several overloaded definitions so that we're able to return the correct pointer type for the different data types that cv::Mat can take. If you don't specify the type, a simple pointer to <code class="language-text">unsined char</code> will be returned, even if this is not the type your Mat contains and we'll need to be careful when doing pointer arithmetic.</p>
<p>With this in mind, let's do our first implementation of the program using one of these member functions.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cxxopts.hpp></span></span>

<span class="token keyword">struct</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> std<span class="token operator">::</span>string file_path<span class="token punctuation">;</span>              <span class="token comment">// filepath of the image</span>
	<span class="token keyword">const</span> std<span class="token operator">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> top_left<span class="token punctuation">;</span>       <span class="token comment">// top left x &amp; y coordinates</span>
	<span class="token keyword">const</span> std<span class="token operator">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> lower_right<span class="token punctuation">;</span>    <span class="token comment">// lower right x &amp; y coordinates</span>
<span class="token punctuation">}</span>

Config <span class="token function">parse_cli</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* parse cli */</span> <span class="token punctuation">}</span>

<span class="token comment">/*
 * Naive way of doing it.
 */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> config <span class="token operator">=</span> <span class="token function">parse_cli</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token operator">::</span>Mat image <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">imread</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>file_path<span class="token punctuation">,</span> cv<span class="token operator">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Resizing the image to 200x200</span>
    cv<span class="token operator">::</span>Mat small_image<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Size size <span class="token punctuation">{</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> small_image<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Renaming because Point2i has better attribute names than std::pair</span>
    cv<span class="token operator">::</span>Point2i top_left <span class="token punctuation">{</span> config<span class="token punctuation">.</span>top_left<span class="token punctuation">.</span>first<span class="token punctuation">,</span> config<span class="token punctuation">.</span>top_left<span class="token punctuation">.</span>second <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Point2i lower_right <span class="token punctuation">{</span> config<span class="token punctuation">.</span>lower_right<span class="token punctuation">.</span>first<span class="token punctuation">,</span> config<span class="token punctuation">.</span>lower_right<span class="token punctuation">.</span>second <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Iterate through the region </span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lower_right<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> lower_right<span class="token punctuation">.</span>y<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            uchar <span class="token operator">*</span>value <span class="token operator">=</span> small_image<span class="token punctuation">.</span>ptr<span class="token operator">&lt;</span>uchar<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">*</span>value <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>          <span class="token comment">// Do the 8-bit inversion to obtain the negative</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"negative"</span><span class="token punctuation">,</span> small_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<br/>
<p>
With this implementation we can run our binary in the command line: 
</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="command-line-prompt"><span data-user=edujtm data-host=localhost></span></span>./regions chip-grayscale.jpg --tlx <span class="token number">50</span> --tly <span class="token number">55</span> --lrx <span class="token number">160</span> --lry <span class="token number">150</span></code></pre></div>
<br/>
<p>
And we obtain the desired result:
</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 200px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADgUlEQVQ4yyWUyS8sURjFb4hxIVjpIKaY53meaZo82tBmgkbMIbHoFhZitsIOCxLEkGCBoAUPT8wxpEWIHQsrf8P7qbpJd25V3XO+c873VYnY2NiAgAAHBwd/f/+YmBgfHx97e3svL6+4uLjQ0FDum5mZmZqaWlpampiYaLVaHmVkZNTV1eXm5gp2KSkpTk5OwNzc3EJCQqBQqVTJycnsg4KCXF1dbWxsAHNzfHy8oaFBqVRqNJqKigqhUChycnJAmpubW1hYREZGpqamgiwuLk5MTPT19U1ISIiOjqZGTU1NV1dXZ2cnLECysrIEv/z8fIrY2dlxFDE8Ky8vLyoqSktLQxHnCgsL+/v7NdJqbm4uLS2l+C84MzOTasBQiP+8vDxgjY2N2CsrKwNcUFAAe2tra319PaTcREJJSUlSUpLghzyQ4Nn39vaOjo4ODg729fW1tbVxyZ47Q0NDHR0dYIiquroaw9nZ2QJ7kKEtLCwMn/Pz8zMzM1NTU5OTk7Ozs4eHh3+lxWZkZKSlpQXGyspKjKBCwEEM2CBzBK+srKyvr6+urh4cHJycnOzv7+/u7i4vL3N/YGAAJPqBIVatVov29vbu7m6sck1CBoPh9vb2n7S2t7eXlpYAQzc3N4fyqqoqkCRKR+Lj48X09DTGoGEkGIyHh4fHx8ejo6PFxUUUcXRhYWFra4t/nU4n55yenk7/OC+gRAw94JpRo8jl5SWCcWhra0uFzc1NuDY2NjhGTcrIFIgV+GFHZvSN2QJ8dXWFYZIDT1TIPj4+fnp6Ghsbwxq51NbWop96gkj+SAsPpL+zs3N2dnZ6eorhi4sLg7TOz8/f398nJiaYCEYNGBQ0SBAMO8ZAKa21tbW9vb2bmxsogFH57u7u9fX15+eHbmMNjDxI7AWPe3p6MIMT+ixni2ySu76+fnl5+fz8hIg+A2aKyAmD+GccBdkwrohRS+vt7e3+/v75+fnr6+v7+/vj44OynDEajTKYWeRFiIqK8vDwEOTOeCObJkM5PDwszyMO5T1Lr9czIcw2rxdIR0dH3tNfMGTkRGU28Hl6ekZERPBh4KUnQqgJiZ5ZWVnRSDS7u7sDc3Fx+QU3NTU5OzsHBgaGh4cDCw4O5g1hWhBCC8iCsfX29oYUOk4CoyyfDf4FGGtrazDogQJ6PgyEgRfwNBZGPz8/TgPjESxyWSD/AXpmxp/Q98/sAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Negative image with for loops"
        title="Negative image with for loops"
        src="/static/85e337792779ec3898358465d2f4f937/772e8/negative-for-loop.png"
        srcset="/static/85e337792779ec3898358465d2f4f937/4dcb9/negative-for-loop.png 188w,
/static/85e337792779ec3898358465d2f4f937/772e8/negative-for-loop.png 200w"
        sizes="(max-width: 200px) 100vw, 200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>The interesting part of the code snippet above is the two for loops:</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token comment">// Iterate through the region </span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lower_right<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> lower_right<span class="token punctuation">.</span>y<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uchar <span class="token operator">*</span>value <span class="token operator">=</span> small_image<span class="token punctuation">.</span>ptr<span class="token operator">&lt;</span>uchar<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>value <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>          <span class="token comment">// Do the 8-bit inversion to obtain the negative</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<br/>
<p>In this we're asking the library to calculate the offset from the start of the underlying data array where our pixel is located, then saving the result of 255 minus the value in that position. The problem with this implementation is that to calculate the offset, we need to do a multiplication to find the row and then a sum to find the column <strong>for every pixel</strong> in our region. This <a href="https://stackoverflow.com/a/25224916/8310836">answer on stackoverflow</a> explains this problem and gives a way around it.</p>
<h3 id="using-roi-operators" style="position:relative;"><a href="#using-roi-operators" aria-label="using roi operators permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using ROI operators</h3>
<p>Since we're applying the same operation in every pixel inside the region, we can use a broadcast operation inside the region of interest, which will make our code shorter and more legible. </p>
<p>OpenCV overrides the <a href="https://docs.opencv.org/4.4.0/d3/d63/classcv_1_1Mat.html#ad543b6bd296ae1247032c750af4718e1">Mat::operator()</a> so we can extract subregions of an image. This extracted subsection is not a copy of the values, only a copy of the header that points to the same underlying data array. In this way, operations on the extracted submatrix will be reflected on the original image.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token comment">/*
 * ROI and broadcasting.
 */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> config <span class="token operator">=</span> <span class="token function">parse_cli</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token operator">::</span>Mat image <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">imread</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>file_path<span class="token punctuation">,</span> cv<span class="token operator">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Resizing the image to 200x200</span>
    cv<span class="token operator">::</span>Mat small_image<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Size size <span class="token punctuation">{</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> small_image<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Renaming because Point2i has better attribute names than std::pair</span>
    cv<span class="token operator">::</span>Point2i top_left <span class="token punctuation">{</span> config<span class="token punctuation">.</span>top_left<span class="token punctuation">.</span>first<span class="token punctuation">,</span> config<span class="token punctuation">.</span>top_left<span class="token punctuation">.</span>second <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Point2i lower_right <span class="token punctuation">{</span> config<span class="token punctuation">.</span>lower_right<span class="token punctuation">.</span>first<span class="token punctuation">,</span> config<span class="token punctuation">.</span>lower_right<span class="token punctuation">.</span>second <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// A better way using region of interest </span>
    <span class="token keyword">int</span> height <span class="token operator">=</span> lower_right<span class="token punctuation">.</span>x <span class="token operator">-</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">int</span> width <span class="token operator">=</span> lower_right<span class="token punctuation">.</span>y <span class="token operator">-</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Rect roi <span class="token punctuation">{</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">,</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Obtains a view of the section in which we're going to make the operation;</span>
    cv<span class="token operator">::</span>Mat image_roi <span class="token operator">=</span> <span class="token function">small_image</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Applies a broadcasting operation</span>
    image_roi <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> image_roi<span class="token punctuation">;</span>

    cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"negative"</span><span class="token punctuation">,</span> small_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<br/>
<p>
If we run our binary with this implementation:
</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="command-line-prompt"><span data-user=edujtm data-host=localhost></span></span>./regions chip-grayscale.jpg --tlx <span class="token number">20</span> --tly <span class="token number">20</span> --lrx <span class="token number">100</span> --lry <span class="token number">60</span></code></pre></div>
<p>We get the desired results again:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 200px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADS0lEQVQ4yyWUyUuCQRjGh0KIDh2CIlrI0ha1RSsqs9IWUzOzssVsT4tKKyUPBZ26dQqCTh2lDhGEyyGQFkgSWk4dunQPunjoH+iX3wcN48w8yzzvOwm9Xq/RaIqKiurr69va2mpqagoLC2tra7u6unQ6XUlJiUwmy83NzcvLy8nJ8Xq9bA0ODq6srNjtdsGsr69PpVK1trZyGq7Ozk6bzWY0GrVabVNTk1wuLygoAMzi8fGxz+cbGhqampryeDwC7rGxsZeXl+/v75+fn2QyCV1vb+/k5GRPTw+k3d3dHR0dLC4uLgaDwZ2dHViGh4ctFouAhnOvr6+/v79fX183NzcjIyMzMzMs9vf3l5aWWq1W2A8PD1lBcGNjg11Q/2BOoPD+/v7x8ZFOpy8uLubn5zc3N7HHUYVC4cl+oVCIldnZWbfbjYXp6WncCVxhCdjn5+fz8/PV1dXy8vLa2tr+/v7R0ZHD4cDIwMAAeNZBEtXCwgI/cSQgYCkWi729vSUSibOzM2RD2Q+HgLGHSSh2d3e3t7e3trbm5uYmJiZwIfjj3PX19d3dXTQajUQi7HE9AATOSDywI4UmgUENhJsShPD7/Xt7e/F4/OnpCduPj48mk4l4DQYDahARLFwIEgF1hgg6qssBcXp6enBwwFWBgb+9vSUFNInt5OTk8vJyaWnJ6XSSwurqKvpms5kIOENTiPPz80AgQAbw0RUQQ4k4jJlM5v7+fnx8nJ9YgI6ugkgq1ejoqKA2UsdACRgKmow52YLHArYZaTuiZZersgUREIFPR/Zjj0OUnZE5F6a9zdmPSXNzM3gMc1tgLpcLUpFKpZhhhrqRIRi88UKYA4OInucxlJeXkyLKVA7DQLi2IKdwOMwqBQDJ9ege2oYnAYVaraZD0USHLUbWwVMjbiceHh5oBvxAhlRdXR1qiDCpqqpibGlpAQOdNfs1NDQQTXt7O50rgIHBtvQ2UQPMHg8bYzQGP6mK9MK5C8plZWW8038w2cAnPUME0ZGUwWOP6+CW08XFxWyhWV1dDayysvIfvL6+XlFR0djYSDDI4gqrgKEgOSlFXIBRKpWcBIYsN2IUYPLz86kErFAA5v+RVGrptUqxcRoYWxBJskD+AHNeeh+0sMLPAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="negative image with region of interest"
        title="negative image with region of interest"
        src="/static/41dbf90f330f231f94f561d98277b148/772e8/roi-negative-image.png"
        srcset="/static/41dbf90f330f231f94f561d98277b148/4dcb9/roi-negative-image.png 188w,
/static/41dbf90f330f231f94f561d98277b148/772e8/roi-negative-image.png 200w"
        sizes="(max-width: 200px) 100vw, 200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h3 id="using-bitwise-operators" style="position:relative;"><a href="#using-bitwise-operators" aria-label="using bitwise operators permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using bitwise operators</h3>
<p>Since a grayscale image with one channel is represented by 8 bits values. We can use bitwise operators to invert our image. If we invert the bits from each pixel, we get the same value as subtracting the intensity value from 255.</p>
<ul>
<li>0 (0b0000_0000) -> 255 (0b1111_1111)</li>
<li>1 (0b0000_0001) -> 254 (0b1111_1110)</li>
<li>2 (0b0000_0010) -> 253 (0b1111_1101)</li>
</ul>
<p>And so on...</p>
<p>With this in mind, we can rewrite our operation using the <a href="https://docs.opencv.org/4.4.0/d2/de8/group__core__array.html#ga0002cf8b418479f4cb49a75442baee2f">cv::bitwise_not</a> operation.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token comment">/*
 * ROI and bitwise operation.
 */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> config <span class="token operator">=</span> <span class="token function">parse_cli</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token operator">::</span>Mat image <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">imread</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>file_path<span class="token punctuation">,</span> cv<span class="token operator">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Resizing the image to 200x200</span>
    cv<span class="token operator">::</span>Mat small_image<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Size size <span class="token punctuation">{</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> small_image<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Renaming because Point2i has better attribute names than std::pair</span>
    cv<span class="token operator">::</span>Point2i top_left <span class="token punctuation">{</span> config<span class="token punctuation">.</span>top_left<span class="token punctuation">.</span>first<span class="token punctuation">,</span> config<span class="token punctuation">.</span>top_left<span class="token punctuation">.</span>second <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Point2i lower_right <span class="token punctuation">{</span> config<span class="token punctuation">.</span>lower_right<span class="token punctuation">.</span>first<span class="token punctuation">,</span> config<span class="token punctuation">.</span>lower_right<span class="token punctuation">.</span>second <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// A better way using region of interest </span>
    <span class="token keyword">int</span> height <span class="token operator">=</span> lower_right<span class="token punctuation">.</span>x <span class="token operator">-</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">int</span> width <span class="token operator">=</span> lower_right<span class="token punctuation">.</span>y <span class="token operator">-</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Rect roi <span class="token punctuation">{</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">,</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Obtains a view of the section in which we're going to make the operation;</span>
    cv<span class="token operator">::</span>Mat image_roi <span class="token operator">=</span> <span class="token function">small_image</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Applies a bitwise_not operation</span>
    cv<span class="token operator">::</span><span class="token function">bitwise_not</span><span class="token punctuation">(</span>image_roi<span class="token punctuation">,</span> image_roi<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"negative"</span><span class="token punctuation">,</span> small_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<br/>
<p>
If you run the resulting binary, you'll get the same results as before.
</p>
<h3 id="performance-comparison" style="position:relative;"><a href="#performance-comparison" aria-label="performance comparison permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Performance comparison</h3>
<p>The last question remaining is if this refactoring is worth it in terms of performance. If the performance gain of using the bitwise operator is not substantial, we might opt to use a simpler implementation.</p>
<p>To test performance of the three scripts, I used the <a href="https://unsplash.com/photos/vruAZdZzQR0">original image</a> which has a size of 3632 x 5456 pixels and removed the constraint on the image being 200 x 200. After that I wrapped the operations for the three scripts with calls to <a href="https://cplusplus.com/reference/chrono/">std::chrono</a> and ran the scripts to invert an subregion of 1000 x 1000 pixels.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp">    <span class="token keyword">auto</span> begin <span class="token operator">=</span> std<span class="token operator">::</span>chrono<span class="token operator">::</span>steady_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// A better way using region of interest </span>
    <span class="token keyword">int</span> height <span class="token operator">=</span> lower_right<span class="token punctuation">.</span>x <span class="token operator">-</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">int</span> width <span class="token operator">=</span> lower_right<span class="token punctuation">.</span>y <span class="token operator">-</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Rect roi <span class="token punctuation">{</span> top_left<span class="token punctuation">.</span>x<span class="token punctuation">,</span> top_left<span class="token punctuation">.</span>y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Obtains a view of the section in which we're going to make the operation;</span>
    cv<span class="token operator">::</span>Mat image_roi <span class="token operator">=</span> <span class="token function">image</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Applies a broadcasting operation</span>
    cv<span class="token operator">::</span><span class="token function">bitwise_not</span><span class="token punctuation">(</span>image_roi<span class="token punctuation">,</span> image_roi<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">auto</span> end <span class="token operator">=</span> std<span class="token operator">::</span>chrono<span class="token operator">::</span>steady_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Time elapsed (roi-bitwise): "</span> <span class="token operator">&lt;&lt;</span> 
          std<span class="token operator">::</span>chrono<span class="token operator">::</span>duration_cast<span class="token operator">&lt;</span>std<span class="token operator">::</span>chrono<span class="token operator">::</span>microseconds<span class="token operator">></span><span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
          <span class="token operator">&lt;&lt;</span> <span class="token string">"[us]"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span></code></pre></div>
<br />
<p>
These were the obtained results: 
</p>
<table>
<thead>
<tr>
<th>Script</th>
<th>Time elapsed (g++ -O2)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>for-loop</td>
<td>1308 (+/- 77) [µs]</td>
<td></td>
</tr>
<tr>
<td>roi-broadcasting</td>
<td>67 (+/- 44) [µs]</td>
<td></td>
</tr>
<tr>
<td>roi-bitwise</td>
<td>45 (+/- 46) [µs]</td>
<td></td>
</tr>
</tbody>
</table>
<p>I've ran the scripts multiple times and the execution time fluctuate around these values. As we can see the for-loop version is an order of magnitude slower and we should avoid using it if there's a better option available.</p>
<h3 id="one-more-example-of-region-of-interest-operators" style="position:relative;"><a href="#one-more-example-of-region-of-interest-operators" aria-label="one more example of region of interest operators permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>One more example of region of interest operators</h3>
<p>Another example where region of interest operators might be useful is when creating a quadrant shift of an image where you shift the top left quadrant with the lower right and the top right with the lower left. An example is as follows:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 200px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC+0lEQVQ4yyXUNU4EYRQH8ElIsISCAhLcNbjbLu7u7iRI8AICoaWgoeAAcAU6CNyIU/DbnSkm37x5f3kyE/z8/CwsLPT19W1sbGxubk5NTc3Ozq6trQ0ODrq/vb1dXFysrKz09vaWlpbOzMx0d3c7Pz4+/v39BWCTk5PuHR0d0Wh0fHx8bm5ub29vdXX15OTk/f1dBHhsbKy5uRl1V1fX8PDw7u4ufDA6OupBqL6+Hp5gf3+/7FD/8/PTAQYvwYGBAXdnkc7OzpgyyvLy8tzc3Pb2djro2Jufn5f6+/u7vLzskXIkEoFhs6WlxXloaCioqqrKzs6mOTExgci9rq4O/uzsDPf39/fd3R3k+vo6pASmwOSgCCoqKpqammCExuJXTU1NQ0ODd5WVlV9fX1jUsri4qDrJbDPoUFRUFGxvb+NrbGzkXOX8YM3JySkoKKiurpY6MjLCNmq9wCjS1tZWVlam7QEpYNmZmZks0CwuLi4pKSksLMStNxIgHQhKCJXhlRbrtheYYNzz8vJCGGWDPTg4yM/PDyt0qYhhDQq7E7BKTXkA8rzD4iwCQyo1NdVBCbW1tcCqU6NBqCIwoeTk5MTExJSUlISEBFJee7ezs8Nwa2srlqysLEhWUWdkZIgoGEWAlcO0tLSkpCRDfnl5OTw8VIsNsyRhnwiEjnhUMFKVx8CeOVeGPGrX19eXl5dYLAOYFjiTYg07I4KQS0tL5hLoMx37/PT0JGSfrDRZEzJYItaTQHp6unXSJMkWxthjG8azj8kndXNzc3R05AW3LGChYD2oganOwgnKtDZKIxCb8/T0tCRRHxPk/v6+zfFIJBK/wm5rksytra3j4+P7+/vn5+dAbZKYtLpXV1e+XsS8MIYIkhduDRmS4Pn5OY9ac3p6GoBpiTxSNMMoAJgPC4sIh/rk0W9jJX5BWa2ADcRaRVBJuBGhk93T04Po9vbWbkfjl4hpm44Dy8HHx4cKtfQwftHHaklUaH6vr68PDw/A4Xr6Yfj4wwbZiH+o/kWBnk4UcQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Chip image with quadrants shifted"
        title="Chip image with quadrants shifted"
        src="/static/3d5ce410ce685ac929e83cbd8f8feb11/772e8/shift-chip.png"
        srcset="/static/3d5ce410ce685ac929e83cbd8f8feb11/4dcb9/shift-chip.png 188w,
/static/3d5ce410ce685ac929e83cbd8f8feb11/772e8/shift-chip.png 200w"
        sizes="(max-width: 200px) 100vw, 200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>At first sight, it might seem like we need to iterate through the half the image, calculate the new position for the pixel and then change places between them, but this can be achieved in a simpler way using one region of interest for each quadrant of the image and the copying the values between them. The implementation is given below:</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> file_path <span class="token operator">=</span> <span class="token function">parse_cli</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">// Read the image</span>
    cv<span class="token operator">::</span>Mat image <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">imread</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> cv<span class="token operator">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token operator">::</span>Mat squared_image<span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Size size <span class="token punctuation">{</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> squared_image<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    image <span class="token operator">=</span> squared_image<span class="token punctuation">;</span>

    cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"before"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Quadrants</span>
    cv<span class="token operator">::</span>Rect top_left <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Rect lower_left <span class="token punctuation">{</span> image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Rect top_right <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span>Rect lower_right <span class="token punctuation">{</span> image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// shifting quadrants</span>
    cv<span class="token operator">::</span>Mat temp <span class="token operator">=</span> cv<span class="token operator">::</span>Mat<span class="token operator">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Changing top_left with lower_right</span>
    <span class="token keyword">auto</span> top_left_view <span class="token operator">=</span> <span class="token function">image</span><span class="token punctuation">(</span>top_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> lower_right_view <span class="token operator">=</span> <span class="token function">image</span><span class="token punctuation">(</span>lower_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

    top_left_view<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    lower_right_view<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>top_left_view<span class="token punctuation">)</span><span class="token punctuation">;</span>
    temp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>lower_right_view<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Changing top_right with lower_left</span>
    <span class="token keyword">auto</span> top_right_view <span class="token operator">=</span> <span class="token function">image</span><span class="token punctuation">(</span>top_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> lower_left_view <span class="token operator">=</span> <span class="token function">image</span><span class="token punctuation">(</span>lower_left<span class="token punctuation">)</span><span class="token punctuation">;</span>

    top_right_view<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    lower_left_view<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>top_right_view<span class="token punctuation">)</span><span class="token punctuation">;</span>
    temp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>lower_left_view<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"after shifting"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token operator">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<br/>
<p>
After a few data copies, we obtain the desired quadrant shift. This is much more legible than if we were to calculate the new position for each pixel in a for loop. 
<p>The problem with this implementation is that it assumes that the image width and height are divisible by 2. A better implementation would check the size of the image and treat this accordingly.</p>
</p></div></div><footer class="Footer-module--footer--3yGWB"><p>Created by <!-- -->Eduardo Macedo<!-- --> with <a href="https://www.gatsbyjs.org/">Gatsby.js</a><span> | </span><a href="https://icons8.com/icons/set/fireplace">Fireplace Icon</a> by <a href="https://icons8.com/">Icons8 </a> </p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/opencv-image-manipulation";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d542304e5dd43fcc15d7.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-d9b1752aa94e680343c3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-3f69c75eb4cb9d9e9f4b.js"],"component---src-pages-about-js":["/component---src-pages-about-js-a07c5010519a9b656571.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-b9a8c84f15d11fe1cf9b.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-9c78996335b2595ce5b3.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2282d6a3ec01f4ebfe39.js"]};/*]]>*/</script><script src="/component---src-templates-blog-js-d9b1752aa94e680343c3.js" async=""></script><script src="/commons-4c1b28b38614419ffced.js" async=""></script><script src="/styles-4f9fb81ff0cc2dbc3273.js" async=""></script><script src="/app-d542304e5dd43fcc15d7.js" async=""></script><script src="/webpack-runtime-11a928335baca9ccf693.js" async=""></script></body></html>